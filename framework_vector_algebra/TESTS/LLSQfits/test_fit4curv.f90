program test_fit4curv

use frmwork_space3d
use dholder_impdefs
use frmwork_basefuns
use frmwork_llsqfit
use fholder_pgrids
use frmwork_parafuns

implicit none

type(point), dimension(:), allocatable :: psample, gridp, psample1,psampley, psamplez
type(point),target :: mid,origin
type(gen_fit) :: myfit,myfity,myfitz
real(kind(0.d0)), dimension(6) :: hess, hessy, hessz
type(vector) :: gradfit, unit_u, unit_v, unit_w, gradfity, gradfitz, r_u, r_v, r_uu, r_uv, r_vv, U
real(kind(0.d0)) :: curvature, area_sumparts,csum, d_max, d_min, d_mean, d_eff
real(kind(0.d0)), dimension(:), allocatable :: f
integer,dimension(:), allocatable :: loc
logical,dimension(:), allocatable :: rem
integer :: i, n
type(vector), dimension(:), allocatable :: dirsample, neval
real(kind(0.d0)) :: mE, mF, mG, mL, mM, mN
logical :: sf1,sf2,sf3
logical :: method
real(kind(0.d0)), dimension(:), allocatable :: b_source
type(vector), dimension(:), allocatable :: nsample

!allocate(psample(23))
!n=3
! psample(1)=point( -0.125000000000000    ,   0.350000000000000    ,   0.333743981218898 )
! psample(2)=point( -0.144894614362053    ,   0.350000000000000    ,   0.325000000000000 )
! psample(3)=point( -0.125000000000000    ,   0.358287556124091    ,   0.325000000000000 )
! psample(4)=point( -0.175000000000000    ,   0.336249217725485    ,   0.325000000000000 )
! psample(5)=point( -0.175000000000000    ,   0.350000000000000    ,   0.310153910846979 )
! psample(6)=point( -0.150000000000000    ,   0.350000000000000    ,   0.322503383728945 )
! psample(7)=point( -0.150000000000000    ,   0.347640548123735    ,   0.325000000000000 )
! psample(8)=point( -0.175000000000000    ,   0.325000000000000    ,   0.336249217725485 )
! psample(9)=point( -0.150000000000000    ,   0.325000000000000    ,   0.347640548123735 )
! psample(10)=point(-0.125000000000000   ,    0.333743981218898   ,    0.350000000000000)
! psample(11)=point(-0.144894614362053   ,    0.325000000000000   ,    0.350000000000000)
! psample(12)=point(-0.175000000000000   ,    0.359033857671887   ,    0.300000000000000)
! psample(13)=point(-0.150000000000000   ,    0.369249205412283   ,    0.300000000000000)
! psample(14)=point(-0.136000800076833   ,    0.375000000000000   ,    0.300000000000000)
! psample(15)=point(-0.125000000000000   ,    0.375000000000000   ,    0.305303867239189)
! psample(16)=point(-0.100000000000000   ,    0.350000000000000   ,    0.341207004954154)
! psample(17)=point(-0.100000000000000   ,    0.341207004954154   ,    0.350000000000000)
! psample(18)=point(-0.100000000000000   ,    0.375000000000000   ,    0.313825453914556)
! psample(19)=point(-0.100000000000000   ,    0.365218018897942   ,    0.325000000000000)
! psample(20)=point(-0.125000000000000   ,    0.379538430331974   ,    0.300000000000000)
! psample(21)=point(-0.100000000000000   ,    0.386560935029972   ,    0.300000000000000)
! psample(22)=point(-0.125000000000000   ,    0.325000000000000   ,    0.358287556124091)
! psample(23)=point(-0.100000000000000   ,    0.325000000000000   ,    0.365218018897942)

! allocate(psample(25))
! n=4
! psample(1)=point(   7.499999999999996E-002  , 0.347497093694256     ,   0.350000000000000 )      
! psample(2)=point(   7.499999999999996E-002  , 0.350000000000000     ,   0.347497093694256 )      
! psample(3)=point(   0.100000000000000       , 0.350000000000000     ,   0.341207004954154 )      
! psample(4)=point(   0.100000000000000       , 0.341207004954154     ,   0.350000000000000 )      
! psample(5)=point(   6.349087322287582E-002  , 0.350000000000000     ,   0.350000000000000 )      
! psample(6)=point(   0.125000000000000       , 0.350000000000000     ,   0.333743981218898 )      
! psample(7)=point(   0.125000000000000       , 0.333743981218898     ,   0.350000000000000 )      
! psample(8)=point(   7.499999999999996E-002  , 0.375000000000000     ,   0.320353038707691 )      
! psample(9)=point(   7.499999999999996E-002  , 0.370839324541934     ,   0.325000000000000 )    
! psample(10)=point(  5.348883127085362E-002 ,  0.375000000000000    ,    0.325000000000000 )    
! psample(11)=point(  5.000000000000004E-002 ,  0.352889478333473    ,    0.350000000000000 )    
! psample(12)=point(  5.000000000000004E-002 ,  0.375000000000000    ,    0.325785727894324 )    
! psample(13)=point(  0.100000000000000      ,  0.375000000000000    ,    0.313825453914556 )    
! psample(14)=point(  0.100000000000000      ,  0.365218018897942    ,    0.325000000000000 )    
! psample(15)=point(  0.125000000000000      ,  0.375000000000000    ,    0.305303867239189 )    
! psample(16)=point(  0.125000000000000      ,  0.358287556124092    ,    0.325000000000000 )    
! psample(17)=point(  7.499999999999996E-002 ,  0.325000000000000    ,    0.370839324541934 )    
! psample(18)=point(  7.499999999999996E-002 ,  0.320353038707692    ,    0.375000000000000 )    
! psample(19)=point(  5.348883127085364E-002 ,  0.325000000000000    ,    0.375000000000000 )    
! psample(20)=point(  0.100000000000000      ,  0.325000000000000    ,    0.365218018897942 )    
! psample(21)=point(  0.100000000000000      ,  0.313825453914556    ,    0.375000000000000 )    
! psample(22)=point(  5.000000000000004E-002 ,  0.325785727894324    ,    0.375000000000000 )    
! psample(23)=point(  5.000000000000004E-002 ,  0.350000000000000    ,    0.352889478333473 )    
! psample(24)=point(  0.125000000000000      , 0.325000000000000     ,   0.358287556124091   )   
! psample(25)=point(  0.125000000000000      , 0.305303867239189     ,   0.375000000000000   )

! allocate(psample(30))
! n=3
! psample(1)=point(   0.300000000000000     ,   0.300000000000000    ,    0.258960593998385     )
! psample(2)=point(   0.300000000000000     ,   0.258960593998385    ,    0.300000000000000     )
! psample(3)=point(   0.258960593998385     ,   0.300000000000000    ,    0.300000000000000     )
! psample(4)=point(   0.350000000000000     ,   0.250000000000000    ,    0.248789423530359     )
! psample(5)=point(   0.350000000000000     ,   0.248789423530359    ,    0.250000000000000     )
! psample(6)=point(   0.349108116022993     ,   0.250000000000000    ,    0.250000000000000     )
! psample(7)=point(   0.350000000000000     ,   0.200000000000000    ,    0.289608416317471     )
! psample(8)=point(   0.341003985925341     ,   0.200000000000000    ,    0.300000000000000     )
! psample(9)=point(   0.307906629254634     ,   0.250000000000000    ,    0.300000000000000     )
! psample(10)=point(  0.307906629254634    ,    0.300000000000000   ,     0.250000000000000     )
! psample(11)=point(  0.341003985925341    ,    0.300000000000000   ,     0.200000000000000     )
! psample(12)=point(  0.350000000000000    ,    0.289608416317471   ,     0.200000000000000     )
! psample(13)=point(  0.250000000000000    ,    0.350000000000000   ,     0.248789423530359     )
! psample(14)=point(  0.250000000000000    ,    0.349108116022993   ,     0.250000000000000     )
! psample(15)=point(  0.248789423530359    ,    0.350000000000000   ,     0.250000000000000     )
! psample(16)=point(  0.200000000000000    ,    0.341003985925341   ,     0.300000000000000     )
! psample(17)=point(  0.200000000000000    ,    0.350000000000000   ,     0.289608416317471     )
! psample(18)=point(  0.250000000000000    ,    0.307906629254633   ,     0.300000000000000     )
! psample(19)=point(  0.289608416317471    ,    0.350000000000000   ,     0.200000000000000     )
! psample(20)=point(  0.300000000000000    ,    0.341003985925341   ,     0.200000000000000     )
! psample(21)=point(  0.300000000000000    ,    0.307906629254634   ,     0.250000000000000     )
! psample(22)=point(  0.250000000000000    ,    0.250000000000000   ,     0.349108116022993     )
! psample(23)=point(  0.250000000000000    ,    0.248789423530359   ,     0.350000000000000     )
! psample(24)=point(  0.248789423530359    ,    0.250000000000000   ,     0.350000000000000     )
! psample(25)=point(  0.300000000000000    ,    0.250000000000000   ,     0.307906629254634     )
! psample(26)=point(   0.300000000000000   ,    0.200000000000000   ,    0.341003985925341     )
! psample(27)=point(   0.289608416317471   ,    0.200000000000000   ,    0.350000000000000     )
! psample(28)=point(   0.200000000000000   ,    0.289608416317471   ,    0.350000000000000     )
! psample(29)=point(   0.200000000000000   ,    0.300000000000000   ,    0.341003985925341     )
! psample(30)=point(   0.250000000000000   ,    0.300000000000000   ,    0.307906629254633 )

! allocate(psample(30))
! n=3
! psample(1)=point(     0.300000000000000  ,    -0.300000000000000    ,   0.239236529381464     )
! psample(2)=point(     0.239236529381464  ,    -0.300000000000000    ,   0.300000000000000     )
! psample(3)=point(     0.300000000000000  ,    -0.239236529381464    ,   0.300000000000000     )
! psample(4)=point(     0.200000000000000  ,    -0.400000000000000    ,   0.195286359648904     )
! psample(5)=point(     0.195286359648903  ,    -0.400000000000000    ,   0.200000000000000     )
! psample(6)=point(     0.200000000000000  ,    -0.397945075585563    ,   0.200000000000000     )
! psample(7)=point(     0.100000000000000  ,    -0.400000000000000    ,   0.256032628132990     )
! psample(8)=point(     0.100000000000000  ,    -0.369490655730898    ,   0.300000000000000     )
! psample(9)=point(     0.200000000000000  ,    -0.330446525157898    ,   0.300000000000000     )
! psample(10)=point(    0.300000000000000  ,    -0.330446525157898    ,   0.200000000000000     )
! psample(11)=point(    0.300000000000000  ,    -0.369490655730898    ,   9.999999999999987E-002)
! psample(12)=point(    0.256032628132991  ,    -0.400000000000000    ,   9.999999999999987E-002)
! psample(13)=point(    0.330446525157898  ,    -0.300000000000000    ,   0.200000000000000     )
! psample(14)=point(    0.369490655730898  ,    -0.300000000000000    ,   9.999999999999987E-002)
! psample(15)=point(    0.397945075585563  ,    -0.200000000000000    ,   0.200000000000000     )
! psample(16)=point(    0.400000000000000  ,    -0.200000000000000    ,   0.195286359648904     )
! psample(17)=point(    0.400000000000000  ,    -0.256032628132991    ,   9.999999999999987E-002)
! psample(18)=point(    0.330446525157898  ,    -0.200000000000000    ,   0.300000000000000     )
! psample(19)=point(    0.400000000000000  ,    -0.195286359648904    ,   0.200000000000000     )
! psample(20)=point(    0.369490655730898  ,    -0.100000000000000    ,   0.300000000000000     )
! psample(21)=point(    0.400000000000000  ,    -0.100000000000000    ,   0.256032628132991     )
! psample(22)=point(    0.100000000000000  ,    -0.300000000000000    ,   0.369490655730898     )
! psample(23)=point(    0.200000000000000  ,    -0.300000000000000    ,   0.330446525157898     )
! psample(24)=point(    0.100000000000000  ,    -0.256032628132991    ,   0.400000000000000     )
! psample(25)=point(    0.195286359648904  ,    -0.200000000000000    ,   0.400000000000000     )
! psample(26)=point(    0.200000000000000  ,    -0.200000000000000    ,   0.397945075585563     )
! psample(27)=point(    0.300000000000000  ,    -0.200000000000000    ,   0.330446525157898     )
! psample(28)=point(    0.200000000000000  ,    -0.195286359648904    ,   0.400000000000000     )
! psample(29)=point(    0.256032628132991  ,    -0.100000000000000    ,   0.400000000000000     )
! psample(30)=point(    0.300000000000000  ,    -0.100000000000000    ,   0.369490655730898     )                            

! allocate(psample(25))
! n=4
! psample(1)=point(    -0.350000000000000  ,     0.100000000000000      ,-0.341207004954154 )    
! psample(2)=point(    -0.350000000000000  ,     7.499999999999996E-002 ,-0.347497093694256 )    
! psample(3)=point(    -0.347497093694256  ,     7.499999999999996E-002 ,-0.350000000000000 )    
! psample(4)=point(    -0.341207004954154  ,     0.100000000000000      ,-0.350000000000000 )    
! psample(5)=point(    -0.352889478333473  ,     5.000000000000004E-002 ,-0.350000000000000 )    
! psample(6)=point(    -0.350000000000000  ,     5.000000000000004E-002 ,-0.352889478333473 )    
! psample(7)=point(    -0.350000000000000  ,     6.349087322287572E-002 ,-0.350000000000000 )    
! psample(8)=point(    -0.375000000000000  ,     5.348883127085338E-002 ,-0.325000000000000 )    
! psample(9)=point(    -0.375000000000000  ,     5.000000000000004E-002 ,-0.325785727894323 )    
! psample(10)=point(   -0.370839324541934  ,     7.499999999999996E-002 ,-0.325000000000000 )    
! psample(11)=point(   -0.325785727894323  ,     5.000000000000004E-002 ,-0.375000000000000 )    
! psample(12)=point(   -0.325000000000000  ,     5.348883127085294E-002 ,-0.375000000000000 )    
! psample(13)=point(   -0.325000000000000  ,     7.499999999999996E-002 ,-0.370839324541934 )    
! psample(14)=point(   -0.365218018897942  ,     0.100000000000000      ,-0.325000000000000 )    
! psample(15)=point(   -0.325000000000000  ,     0.100000000000000      ,-0.365218018897942 )    
! psample(16)=point(   -0.320353038707692  ,     7.499999999999996E-002 ,-0.375000000000000 )    
! psample(17)=point(   -0.313825453914556  ,     0.100000000000000      ,-0.375000000000000 )    
! psample(18)=point(   -0.350000000000000  ,     0.125000000000000      ,-0.333743981218898 )    
! psample(19)=point(   -0.358287556124091  ,     0.125000000000000      ,-0.325000000000000 )    
! psample(20)=point(   -0.325000000000000  ,     0.125000000000000      ,-0.358287556124091 )    
! psample(21)=point(   -0.333743981218898  ,     0.125000000000000      ,-0.350000000000000 )    
! psample(22)=point(   -0.305303867239189  ,     0.125000000000000      ,-0.375000000000000 )    
! psample(23)=point(   -0.375000000000000  ,     7.499999999999996E-002 ,-0.320353038707692 )    
! psample(24)=point(   -0.375000000000000  ,     0.100000000000000      ,-0.313825453914556 )    
! psample(25)=point(   -0.375000000000000  ,     0.125000000000000      ,-0.305303867239189 )

!    allocate(psample(18))
!    n=4
!    psample(1)=point(  -0.600000000000000  ,     0.900000000000000   ,    0.822891566265060  )   
!    psample(2)=point(  -0.677108433734939  ,     0.900000000000000   ,    0.900000000000000  )   
!    psample(3)=point(  -0.677108433734940  ,      1.00000000000000   ,    0.900000000000000  )   
!    psample(4)=point(  -0.600000000000000  ,      1.00000000000000   ,    0.822891566265060  )   
!    psample(5)=point(  -0.600000000000000  ,     0.800000000000000   ,    0.822891566265060  )   
!    psample(6)=point(  -0.677108433734940  ,     0.800000000000000   ,    0.900000000000000  )   
!    psample(7)=point(  -0.500000000000000  ,     0.800000000000000   ,    0.722891566265060  )   
!    psample(8)=point(  -0.577108433734940  ,     0.800000000000000   ,    0.800000000000000  )   
!    psample(9)=point(  -0.577108433734940  ,     0.900000000000000   ,    0.800000000000000  )   
!    psample(10)=point( -0.500000000000000  ,     0.900000000000000   ,    0.722891566265060  )   
!    psample(11)=point( -0.577108433734940  ,      1.00000000000000   ,    0.800000000000000  )   
!    psample(12)=point( -0.500000000000000  ,      1.00000000000000   ,    0.722891566265060  )   
!    psample(13)=point( -0.700000000000000  ,     0.800000000000000   ,    0.938775510204081  )   
!    psample(14)=point( -0.730612244897959  ,     0.800000000000000   ,     1.00000000000000  )   
!    psample(15)=point( -0.730612244897959  ,     0.900000000000000   ,     1.00000000000000  )   
!    psample(16)=point( -0.700000000000000  ,     0.900000000000000   ,    0.938775510204082  )   
!    psample(17)=point( -0.730612244897960  ,      1.00000000000000   ,     1.00000000000000  )   
!   psample(18)=point( -0.700000000000000  ,      1.00000000000000   ,    0.938775510204080   )

!  allocate(psample(18))
!  n=4
!  psample(1)=point(   -0.600000000000000   ,    -1.00000000000000    ,   0.822891566265060       )   
!  psample(2)=point(   -0.677108433734940   ,    -1.00000000000000    ,   0.900000000000000       )   
!  psample(3)=point(   -0.677108433734940   ,   -0.900000000000000    ,   0.900000000000000       )   
!  psample(4)=point(   -0.600000000000000   ,   -0.900000000000000    ,   0.822891566265060       )   
!  psample(5)=point(   -0.500000000000000   ,    -1.00000000000000    ,   0.722891566265060       )   
!  psample(6)=point(   -0.577108433734940   ,    -1.00000000000000    ,   0.800000000000000       )   
!  psample(7)=point(   -0.577108433734940   ,   -0.900000000000000    ,   0.800000000000000       )   
!  psample(8)=point(   -0.500000000000000   ,   -0.900000000000000    ,   0.722891566265060       )   
!  psample(9)=point(   -0.677108433734940   ,   -0.800000000000000    ,   0.900000000000000       )   
!  psample(10)=point(  -0.600000000000000   ,   -0.800000000000000    ,   0.822891566265060       )   
!  psample(11)=point(  -0.577108433734940   ,   -0.800000000000000    ,   0.800000000000000       )   
!  psample(12)=point(  -0.500000000000000   ,   -0.800000000000000    ,   0.722891566265060       )   
!  psample(13)=point(  -0.700000000000000   ,    -1.00000000000000    ,   0.938775510204082       )   
!  psample(14)=point(  -0.730612244897959   ,    -1.00000000000000    ,    1.00000000000000       )   
!  psample(15)=point(  -0.730612244897959   ,   -0.900000000000000    ,    1.00000000000000       )   
!  psample(16)=point(  -0.700000000000000   ,   -0.900000000000000    ,   0.938775510204081       )   
!  psample(17)=point(  -0.730612244897959   ,   -0.800000000000000    ,    1.00000000000000       )   
!  psample(18)=point(  -0.700000000000000   ,   -0.800000000000000    ,   0.938775510204081       )

! allocate(psample(35)) ! 23 is the primary sample
! n=3
! psample(1)=point(   0.325000000000000   ,   -0.125000000000000   ,   -0.358980104271427    ) 
! psample(2)=point(   0.325000000000000   ,   -0.145561835426664   ,   -0.350000000000000    ) 
! psample(3)=point(   0.334389295584446   ,   -0.125000000000000   ,   -0.350000000000000    ) 
! psample(4)=point(   0.300000000000000   ,   -0.150000000000000   ,   -0.369391201411484    ) 
! psample(5)=point(   0.300000000000000   ,   -0.175000000000000   ,   -0.359651277494510    ) 
! psample(6)=point(   0.310666665020431   ,   -0.175000000000000   ,   -0.350000000000000    ) 
! psample(7)=point(   0.322706603862894   ,   -0.150000000000000   ,   -0.350000000000000    ) 
! psample(8)=point(   0.300000000000000   ,   -0.125000000000000   ,   -0.380213881050082    ) 
! psample(9)=point(   0.300000000000000   ,   -0.136842250329084   ,   -0.375000000000000    ) 
! psample(10)=point(  0.305943029976068   ,   -0.125000000000000   ,   -0.375000000000000    ) 
! psample(11)=point(  0.300000000000000   ,   -0.100000000000000   ,   -0.387094583914669    ) 
! psample(12)=point(  0.314180658381175   ,   -0.100000000000000   ,   -0.375000000000000    ) 
! psample(13)=point(  0.325000000000000   ,   -0.100000000000000   ,   -0.365485338278554    ) 
! psample(14)=point(  0.341399761994299   ,   -0.100000000000000   ,   -0.350000000000000    ) 
! psample(15)=point(  0.325000000000000   ,   -0.175000000000000   ,   -0.336741007611008    ) 
! psample(16)=point(  0.325000000000000   ,   -0.150000000000000   ,   -0.347812808616156    ) 
! psample(17)=point(  0.336741007611008   ,   -0.175000000000000   ,   -0.325000000000000    ) 
! psample(18)=point(  0.347812808616156   ,   -0.150000000000000   ,   -0.325000000000000    ) 
! psample(19)=point(  0.350000000000000   ,   -0.145561835426664   ,   -0.325000000000000    )  
! psample(20)=point(  0.350000000000000   ,   -0.125000000000000   ,   -0.334389295584446    )  
! psample(21)=point(  0.358980104271426   ,   -0.125000000000000   ,   -0.325000000000000    )  
! psample(22)=point(  0.350000000000000   ,   -0.100000000000000   ,   -0.341399761994299    )  
! psample(23)=point(  0.365485338278554   ,   -0.100000000000000   ,   -0.325000000000000    )  
! psample(24)=point(  0.275000000000000   ,   -0.175000000000000   ,   -0.379253592391208    ) 
! psample(25)=point(  0.275000000000000   ,   -0.182303382923042   ,   -0.375000000000000    ) 
! psample(26)=point(  0.280126918527552   ,   -0.175000000000000   ,   -0.375000000000000    ) 
! psample(27)=point(  0.275000000000000   ,   -0.200000000000000   ,   -0.365604931500589    ) 
! psample(28)=point(  0.294354109520781   ,   -0.200000000000000   ,   -0.350000000000000    ) 
! psample(29)=point(  0.300000000000000   ,   -0.191872645927445   ,   -0.350000000000000    ) 
! psample(30)=point(  0.275000000000000   ,   -0.150000000000000   ,   -0.389108366238537    ) 
! psample(31)=point(  0.293286954187994   ,   -0.150000000000000   ,   -0.375000000000000    ) 
! psample(32)=point(  0.275000000000000   ,   -0.125000000000000   ,   -0.397412813242008    ) 
! psample(33)=point(  0.300000000000000   ,   -0.200000000000000   ,   -0.345008807707706    ) 
! psample(34)=point(  0.321719953386102   ,   -0.200000000000000   ,   -0.325000000000000    ) 
! psample(35)=point(  0.325000000000000   ,   -0.195079188424702   ,   -0.325000000000000    )

! allocate(psample(35)) ! 23 is the primary sample
! n=4
! psample(1)=point(  -0.350000000000000   ,   -7.499999999999996E-002 ,-0.347649954809103 )    
! psample(2)=point(  -0.350000000000000   ,   -0.100000000000000      ,-0.341399761994299 )    
! psample(3)=point(  -0.341399761994299   ,   -0.100000000000000      ,-0.350000000000000 )    
! psample(4)=point(  -0.347649954809103   ,   -7.499999999999996E-002 ,-0.350000000000000 )    
! psample(5)=point(  -0.358980104271426   ,   -0.125000000000000      ,-0.325000000000000 )    
! psample(6)=point(  -0.350000000000000   ,   -0.125000000000000      ,-0.334389295584446 )    
! psample(7)=point(  -0.365485338278554   ,   -0.100000000000000      ,-0.325000000000000 )    
! psample(8)=point(  -0.334389295584445   ,   -0.125000000000000      ,-0.350000000000000 )    
! psample(9)=point(  -0.325000000000000   ,   -0.125000000000000      ,-0.358980104271426 )    
! psample(10)=point( -0.325000000000000   ,   -0.100000000000000      ,-0.365485338278554 )    
! psample(11)=point( -0.370946667974933   ,   -7.499999999999996E-002 ,-0.325000000000000 )    
! psample(12)=point( -0.325000000000000   ,   -7.499999999999996E-002 ,-0.370946667974932 )    
! psample(13)=point( -0.305943029976068   ,   -0.125000000000000      ,-0.375000000000000 )    
! psample(14)=point( -0.314180658381175   ,   -0.100000000000000      ,-0.375000000000000 )    
! psample(15)=point( -0.320534998600308   ,   -7.499999999999996E-002 ,-0.375000000000000 )    
! psample(16)=point( -0.350000000000000   ,   -6.504012057983030E-002 ,-0.350000000000000 )    
! psample(17)=point( -0.350000000000000   ,   -5.000000000000004E-002 ,-0.353553911959772 )    
! psample(18)=point( -0.353553911959772   ,   -5.000000000000004E-002 ,-0.350000000000000 )    
! psample(19)=point( -0.375000000000000   ,   -5.000000000000004E-002 ,-0.326297146072421 )    
! psample(20)=point( -0.375000000000000   ,   -5.527435883352980E-002 ,-0.325000000000000 )    
! psample(21)=point( -0.325000000000000   ,   -5.527435883352712E-002 ,-0.375000000000000 )    
! psample(22)=point( -0.326297146072420   ,   -5.000000000000004E-002 ,-0.375000000000000 )    
! psample(23)=point( -0.375000000000000   ,   -0.100000000000000      ,-0.314180658381175 )    
! psample(24)=point( -0.375000000000000   ,   -0.125000000000000      ,-0.305943029976068 )    
! psample(25)=point( -0.375000000000000   ,   -7.499999999999996E-002 ,-0.320534998600309 )    
! psample(26)=point( -0.350000000000000   ,   -0.145561835426664      ,-0.325000000000000 )    
! psample(27)=point( -0.325000000000000   ,   -0.145561835426664      ,-0.350000000000000 )    
! psample(28)=point( -0.347812808616155   ,   -0.150000000000000      ,-0.325000000000000 )    
! psample(29)=point( -0.325000000000000   ,   -0.150000000000000      ,-0.347812808616156 )    
! psample(30)=point( -0.375000000000000   ,   -0.136842250329084      ,-0.300000000000000 )    
! psample(31)=point( -0.380213881050082   ,   -0.125000000000000      ,-0.300000000000000 )    
! psample(32)=point( -0.369391201411485   ,   -0.150000000000000      ,-0.300000000000000 )    
! psample(33)=point( -0.350000000000000   ,   -0.150000000000000      ,-0.322706603862893 )    
! psample(34)=point( -0.387094583914669   ,   -0.100000000000000      ,-0.300000000000000 )    
! psample(35)=point( -0.391800551422683   ,   -7.499999999999996E-002 ,-0.300000000000000 )

! allocate(psample(51))
! n=4
! psample(1)=point(   0.000000000000000E+000, -0.350000000000000,      -0.357471446839490  )
! psample(2)=point(   0.000000000000000E+000, -0.357471446839490,      -0.350000000000000  )
! psample(3)=point(   2.499999999999991E-002, -0.356579757450839,      -0.350000000000000  )
! psample(4)=point(   2.499999999999991E-002, -0.350000000000000,      -0.356579757450839  )
! psample(5)=point(  -2.500000000000002E-002, -0.350000000000000,      -0.356579757450838  )
! psample(6)=point(  -2.500000000000002E-002, -0.356579757450838,      -0.350000000000000  )
! psample(7)=point(   5.000000000000004E-002, -0.353553911959773,      -0.350000000000000  )
! psample(8)=point(   5.000000000000004E-002, -0.350000000000000,      -0.353553911959773  )
! psample(9)=point(  -2.500000000000002E-002, -0.325000000000000,      -0.379330498128880  )
! psample(10)=point( -2.500000000000002E-002, -0.329693965146699,      -0.375000000000000  )
! psample(11)=point(  0.000000000000000E+000, -0.330736137136870,      -0.375000000000000  )
! psample(12)=point(  0.000000000000000E+000, -0.325000000000000,      -0.380285012592048  )
! psample(13)=point(  2.499999999999991E-002, -0.329693965146700,      -0.375000000000000  )
! psample(14)=point(  2.499999999999991E-002, -0.325000000000000,      -0.379330498128881  )
! psample(15)=point(  5.000000000000004E-002, -0.326297146072421,      -0.375000000000000  )
! psample(16)=point(  5.000000000000004E-002, -0.325000000000000,      -0.376201766299078  )
! psample(17)=point( -2.500000000000002E-002, -0.375000000000000,      -0.329693965146699  )
! psample(18)=point( -2.500000000000002E-002, -0.379330498128880,      -0.325000000000000  )
! psample(19)=point(  0.000000000000000E+000, -0.380285012592048,      -0.325000000000000  )
! psample(20)=point(  0.000000000000000E+000, -0.375000000000000,      -0.330736137136870  )
! psample(21)=point(  2.499999999999991E-002, -0.379330498128881,      -0.325000000000000  )
! psample(22)=point(  2.499999999999991E-002, -0.375000000000000,      -0.329693965146699  )
! psample(23)=point(  5.000000000000004E-002, -0.376201766299078,      -0.325000000000000  )
! psample(24)=point(  5.000000000000004E-002, -0.375000000000000,      -0.326297146072421  )
! psample(25)=point( -5.000000000000004E-002, -0.350000000000000,      -0.353553911959772  )
! psample(26)=point( -5.000000000000004E-002, -0.353553911959772,      -0.350000000000000  )
! psample(27)=point( -5.000000000000004E-002, -0.325000000000000,      -0.376201766299078  )
! psample(28)=point( -5.000000000000004E-002, -0.326297146072420,      -0.375000000000000  )
! psample(29)=point( -5.000000000000004E-002, -0.375000000000000,      -0.326297146072420  )
! psample(30)=point( -5.000000000000004E-002, -0.376201766299078,      -0.325000000000000  )
! psample(31)=point(  6.504012057983301E-002, -0.350000000000000,      -0.350000000000000  )
! psample(32)=point(  5.527435883353073E-002, -0.325000000000000,      -0.375000000000000  )
! psample(33)=point(  7.499999999999996E-002, -0.347649954809104,      -0.350000000000000  )
! psample(34)=point(  7.499999999999996E-002, -0.325000000000000,      -0.370946667974933  )
! psample(35)=point(  5.527435883353054E-002, -0.375000000000000,      -0.325000000000000  )
! psample(36)=point(  7.499999999999996E-002, -0.370946667974933,      -0.325000000000000  )
! psample(37)=point(  7.499999999999996E-002, -0.350000000000000,      -0.347649954809104  )
! psample(38)=point( -5.000000000000004E-002, -0.300000000000000,      -0.395563985825785  )
! psample(39)=point( -2.500000000000002E-002, -0.300000000000000,      -0.398199225091398  )
! psample(40)=point( 0.000000000000000E+000 , -0.300000000000000,      -0.399152533139609  )
! psample(41)=point( 2.499999999999991E-002 , -0.300000000000000,      -0.398199225091398  )
! psample(42)=point( 5.000000000000004E-002 , -0.300000000000000,      -0.395563985825785  )
! psample(43)=point( 7.499999999999996E-002 , -0.320534998600309,      -0.375000000000000  )
! psample(44)=point( 7.499999999999996E-002 , -0.300000000000000,      -0.391800551422683  )
! psample(45)=point(-5.000000000000004E-002 , -0.395563985825785,      -0.300000000000000  )
! psample(46)=point(-2.500000000000002E-002 , -0.398199225091398,      -0.300000000000000  )
! psample(47)=point( 0.000000000000000E+000 , -0.399152533139610,      -0.300000000000000  )
! psample(48)=point( 2.499999999999991E-002 , -0.398199225091398,      -0.300000000000000  )
! psample(49)=point( 5.000000000000004E-002 , -0.395563985825785,      -0.300000000000000  )
! psample(50)=point( 7.499999999999996E-002 , -0.391800551422683,      -0.300000000000000  )
! psample(51)=point( 7.499999999999996E-002 , -0.375000000000000,      -0.320534998600309  )

! allocate(psample(18))
! n=4
! psample(1)=point(  -0.700000000000000   ,    -1.00000000000000    ,   0.813295128939828  )   
! psample(2)=point(  -0.793050430504305   ,    -1.00000000000000    ,   0.900000000000000  )   
! psample(3)=point(  -0.793050430504305   ,   -0.900000000000000    ,   0.900000000000000  )   
! psample(4)=point(  -0.700000000000000   ,   -0.900000000000000    ,   0.813295128939828  )   
! psample(5)=point(  -0.600000000000000   ,    -1.00000000000000    ,   0.713302752293578  )   
! psample(6)=point(  -0.686697247706422   ,    -1.00000000000000    ,   0.800000000000000  )   
! psample(7)=point(  -0.686697247706422   ,   -0.900000000000000    ,   0.800000000000000  )   
! psample(8)=point(  -0.600000000000000   ,   -0.900000000000000    ,   0.713302752293578  )   
! psample(9)=point(  -0.793050430504305   ,   -0.800000000000000    ,   0.900000000000000  )   
! psample(10)=point( -0.700000000000000   ,   -0.800000000000000    ,   0.813295128939828  )   
! psample(11)=point( -0.686697247706422   ,   -0.800000000000000    ,   0.800000000000000  )   
! psample(12)=point( -0.600000000000000   ,   -0.800000000000000    ,   0.713302752293578  )   
! psample(13)=point( -0.800000000000000   ,    -1.00000000000000    ,   0.908619374523265  )   
! psample(14)=point( -0.853866906474820   ,    -1.00000000000000    ,    1.00000000000000  )   
! psample(15)=point( -0.853866906474820   ,   -0.900000000000000    ,    1.00000000000000  )   
! psample(16)=point( -0.800000000000000   ,   -0.900000000000000    ,   0.908619374523264  )   
! psample(17)=point( -0.853866906474820   ,   -0.800000000000000    ,    1.00000000000000  )   
! psample(18)=point( -0.800000000000000   ,   -0.800000000000000    ,   0.908619374523264  )   

! allocate(psample(17))
! n=3
! psample(1)=point(  0.000000000000000E+000  , 1.00000000000000   ,   -0.746195431815110   )  
! psample(2)=point(   0.000000000000000E+000 , 0.920705254610833  ,    -0.700000000000000  )   
! psample(3)=point(  -4.619543181511037E-002 ,  1.00000000000000  ,    -0.700000000000000  )   
! psample(4)=point(   0.100000000000000      , 0.900000000000000  ,    -0.784761823459109  )   
! psample(5)=point(   0.100000000000000      , 0.821273390421820  ,    -0.700000000000000  )   
! psample(6)=point(   1.523817654089081E-002 , 0.900000000000000  ,    -0.700000000000000  )   
! psample(7)=point(   0.100000000000000      ,  1.00000000000000  ,    -0.845799276430390  )   
! psample(8)=point(   0.100000000000000      , 0.920705254610833  ,    -0.800000000000000  )   
! psample(9)=point(   5.380456818488982E-002 ,  1.00000000000000  ,    -0.800000000000000  )   
! psample(10)=point(  0.000000000000000E+000 , 0.900000000000000  ,    -0.684761823459109  )   
! psample(11)=point(  0.000000000000000E+000 , 0.821273390421820  ,    -0.600000000000000  )   
! psample(12)=point( -8.476182345910865E-002 , 0.900000000000000  ,    -0.600000000000000  )   
! psample(13)=point( -0.100000000000000      ,  1.00000000000000  ,    -0.646195431815110  )   
! psample(14)=point( -0.100000000000000      , 0.920705254610834  ,    -0.600000000000000  )   
! psample(15)=point( -0.146195431815110      ,  1.00000000000000  ,    -0.600000000000000  )   
! psample(16)=point(  0.100000000000000      , 0.800000000000000  ,    -0.678359412808518  )   
! psample(17)=point(  2.164058719148247E-002 , 0.800000000000000  ,    -0.600000000000000  )   

!  allocate(psample(22))
!  n=4
! psample(1)=point(   -1.00000000000000    ,   0.381723458180794  ,     0.800000000000000  )   
! psample(2)=point(   -1.00000000000000    ,   0.400000000000000  ,     0.781723458180794  )   
! psample(3)=point(  -0.900000000000000    ,   0.400000000000000  ,     0.727884860320965  )   
! psample(4)=point(  -0.900000000000000    ,   0.327884860320965  ,     0.800000000000000  )   
! psample(5)=point(  -0.800000000000000    ,   0.300000000000000  ,     0.721640587191483  )   
! psample(6)=point(  -0.800000000000000    ,   0.221640587191483  ,     0.800000000000000  )   
! psample(7)=point(  -0.874736518193707    ,   0.300000000000000  ,     0.800000000000000  )   
! psample(8)=point(  -0.800000000000000    ,   0.400000000000000  ,     0.621640587191483  )   
! psample(9)=point(  -0.800000000000000    ,   0.321640587191483  ,     0.700000000000000  )   
! psample(10)=point( -0.874736518193707    ,   0.400000000000000  ,     0.700000000000000  )   
! psample(11)=point(  -1.00000000000000    ,   0.481723458180794  ,     0.700000000000000  )   
! psample(12)=point(  -1.00000000000000    ,   0.500000000000000  ,     0.681723458180794  )   
! psample(13)=point( -0.900000000000000    ,   0.500000000000000  ,     0.627884860320965  )   
! psample(14)=point( -0.900000000000000    ,   0.427884860320965  ,     0.700000000000000  )   
! psample(15)=point( -0.874736518193707    ,   0.500000000000000  ,     0.600000000000000  )   
! psample(16)=point( -0.800000000000000    ,   0.421640587191482  ,     0.600000000000000  )   
! psample(17)=point(  -1.00000000000000    ,   0.277209653092006  ,     0.900000000000000  )   
! psample(18)=point(  -1.00000000000000    ,   0.300000000000000  ,     0.879343814080656  )   
! psample(19)=point( -0.900000000000000    ,   0.300000000000000  ,     0.827387207071971  )   
! psample(20)=point( -0.900000000000000    ,   0.221509059767421  ,     0.900000000000000  )   
! psample(21)=point( -0.800000000000000    ,   0.200000000000000  ,     0.821273390421821  )   
! psample(22)=point( -0.880625253755583    ,   0.200000000000000  ,     0.900000000000000  )

! allocate(psample(22))
! n=4
! psample(1)=point(   0.390867979576951    ,   0.800000000000000   ,    -1.00000000000000   )  
! psample(2)=point(   0.400000000000000    ,   0.790867979576952   ,    -1.00000000000000   )  
! psample(3)=point(   0.400000000000000    ,   0.723777445109781   ,   -0.900000000000000   )  
! psample(4)=point(   0.323777445109781    ,   0.800000000000000   ,   -0.900000000000000   )  
! psample(5)=point(   0.490867979576952    ,   0.700000000000000   ,    -1.00000000000000   )  
! psample(6)=point(   0.500000000000000    ,   0.690867979576952   ,    -1.00000000000000   )  
! psample(7)=point(   0.500000000000000    ,   0.623777445109781   ,   -0.900000000000000   )  
! psample(8)=point(   0.423777445109781    ,   0.700000000000000   ,   -0.900000000000000   )  
! psample(9)=point(   0.290240927111924    ,   0.900000000000000   ,    -1.00000000000000   )  
! psample(10)=point(  0.300000000000000    ,   0.890682777696899   ,    -1.00000000000000   )  
! psample(11)=point(  0.300000000000000    ,   0.823749792324307   ,   -0.900000000000000   )  
! psample(12)=point(  0.221634081789465    ,   0.900000000000000   ,   -0.900000000000000   )  
! psample(13)=point(  0.400000000000000    ,   0.700000000000000   ,   -0.877262605376172   )  
! psample(14)=point(  0.400000000000000    ,   0.621640587191483   ,   -0.800000000000000   )  
! psample(15)=point(  0.321640587191483    ,   0.700000000000000   ,   -0.800000000000000   )  
! psample(16)=point(  0.300000000000000    ,   0.800000000000000   ,   -0.877262605376173   )  
! psample(17)=point(  0.300000000000000    ,   0.721640587191483   ,   -0.800000000000000   )  
! psample(18)=point(  0.221640587191483    ,   0.800000000000000   ,   -0.800000000000000   )  
! psample(19)=point(  0.500000000000000    ,   0.600000000000000   ,   -0.877262605376173   )  
! psample(20)=point(  0.421640587191482    ,   0.600000000000000   ,   -0.800000000000000   )  
! psample(21)=point(  0.200000000000000    ,   0.821616177892362   ,   -0.800000000000000   )  
! psample(22)=point(  0.200000000000000    ,   0.900000000000000   ,   -0.879336214629373   )

! allocate(psample(15))
! n=5
! psample(1)=point(  -0.900000000000000    ,   0.989394127121794     ,   1.00000000000000   )  
! psample(2)=point(  -0.900000000000000    ,    1.00000000000000     ,  0.979214892755969   )  
! psample(3)=point(  -0.878653841959476    ,    1.00000000000000     ,  0.900000000000000   )  
! psample(4)=point(  -0.832109409338337    ,   0.900000000000000     ,  0.900000000000000   )  
! psample(5)=point(  -0.853884012272030    ,   0.900000000000000     ,   1.00000000000000   )  
! psample(6)=point(  -0.800000000000000    ,   0.900000000000000     ,  0.813566726329521   )  
! psample(7)=point(  -0.800000000000000    ,   0.856817423989815     ,  0.900000000000000   )  
! psample(8)=point(  -0.800000000000000    ,   0.822298688131740     ,   1.00000000000000   )  
! psample(9)=point(  -0.905326916694325    ,    1.00000000000000     ,   1.00000000000000   )  
! psample(10)=point( -0.843582528088725    ,    1.00000000000000     ,  0.800000000000000   )  
! psample(11)=point( -0.800000000000000    ,   0.909596978411090     ,  0.800000000000000   )  
! psample(12)=point( -0.794382756368387    ,   0.900000000000000     ,  0.800000000000000   )  
! psample(13)=point( -0.729089156204124    ,   0.800000000000000     ,  0.800000000000000   )  
! psample(14)=point( -0.760022395222353    ,   0.800000000000000     ,  0.900000000000000   )  
! psample(15)=point( -0.783467723566125    ,   0.800000000000000     ,   1.00000000000000   )

! allocate(psample(17))
!  n=3
! psample(1)=point(  -0.200000000000000    ,  -0.800000000000000     ,  0.951644736842105  )   
! psample(2)=point(  -0.200000000000000    ,  -0.847589928057554     ,   1.00000000000000  )   
! psample(3)=point(  -0.266515837104073    ,  -0.800000000000000     ,   1.00000000000000  )   
! psample(4)=point(  -0.100000000000000    ,  -0.900000000000000     ,  0.986349348899865  )   
! psample(5)=point(  -0.100000000000000    ,  -0.912069878242456     ,   1.00000000000000  )   
! psample(6)=point(  -0.117262918796139    ,  -0.900000000000000     ,   1.00000000000000  )   
! psample(7)=point(  -0.100000000000000    ,  -0.800000000000000     ,  0.899524838012959  )   
! psample(8)=point(  -0.100000000000000    ,  -0.800568769389866     ,  0.900000000000000  )   
! psample(9)=point(  -0.100772471910113    ,  -0.800000000000000     ,  0.900000000000000  )   
! psample(10)=point( -0.400000000000000    ,  -0.713309982486865     ,   1.00000000000000  )   
! psample(11)=point( -0.400000000000000    ,  -0.700000000000000     ,  0.986349348899865  )   
! psample(12)=point( -0.300000000000000    ,  -0.700000000000000     ,  0.925362074772650  )   
! psample(13)=point( -0.300000000000000    ,  -0.776891047883415     ,   1.00000000000000  )   
! psample(14)=point( -0.200000000000000    ,  -0.700000000000000     ,  0.872116736990154  )   
! psample(15)=point( -0.200000000000000    ,  -0.735947416137806     ,  0.900000000000000  )   
! psample(16)=point( -0.251293661060803    ,  -0.700000000000000      , 0.900000000000000  )   
! psample(17)=point( -0.100000000000000    ,  -0.700000000000000      , 0.827883263009845  )


!allocate(psample(17))
!n=3
! psample(1)=point(  0.900000000000000     ,   1.00000000000000    ,  -0.942012214721954     )
! psample(2)=point(   0.900000000000000    ,   0.933145780051151   ,   -0.900000000000000    ) 
! psample(3)=point(   0.813500992720053    ,    1.00000000000000   ,   -0.900000000000000    ) 
! psample(4)=point(    1.00000000000000    ,   0.900000000000000   ,   -0.924100542138985    ) 
! psample(5)=point(    1.00000000000000    ,   0.868410852713178   ,   -0.900000000000000    ) 
! psample(6)=point(   0.949846153846153    ,   0.900000000000000   ,   -0.900000000000000    ) 
! psample(7)=point(    1.00000000000000    ,    1.00000000000000   ,   -0.988266199649737    ) 
! psample(8)=point(   0.800000000000000    ,   0.900000000000000   ,   -0.829692585895117    ) 
! psample(9)=point(   0.800000000000000    ,   0.864535637149028   ,   -0.800000000000000    ) 
! psample(10)=point(  0.746444879321592    ,   0.900000000000000   ,   -0.800000000000000    ) 
! psample(11)=point(  0.900000000000000    ,   0.900000000000000   ,   -0.876132596685083    ) 
! psample(12)=point(  0.900000000000000    ,   0.800000000000000   ,   -0.802152317880795    ) 
! psample(13)=point(  0.896636481241914    ,   0.800000000000000   ,   -0.800000000000000    ) 
! psample(14)=point(  0.700000000000000    ,   0.935760924158714   ,   -0.800000000000000    ) 
! psample(15)=point(  0.700000000000000    ,    1.00000000000000   ,   -0.843936791480591    ) 
! psample(16)=point(  0.800000000000000    ,    1.00000000000000   ,   -0.892316384180791    ) 
! psample(17)=point(   1.00000000000000    ,   0.800000000000000   ,   -0.848145427836945    )
! psample(1)=point(  -0.100000000000000     , -0.900000000000000    ,   0.974832693143457   )  
! psample(2)=point(  -0.100000000000000     , -0.922500771705345    ,    1.00000000000000   )  
! psample(3)=point(  -0.131107334373041     , -0.900000000000000    ,    1.00000000000000   )  
! psample(4)=point(  -5.000000000000004E-002, -0.950000000000000    ,   0.993484738077970   )  
! psample(5)=point(  -5.000000000000004E-002, -0.954872937077372    ,    1.00000000000000   )  
! psample(6)=point(  -5.716659074569692E-002, -0.950000000000000    ,    1.00000000000000   )  
! psample(7)=point(  -5.000000000000004E-002, -0.900000000000000    ,   0.948842199942554   )  
! psample(8)=point(  -5.000000000000004E-002, -0.901540106087343    ,   0.950000000000000   )  
! psample(9)=point(  -5.210535851546116E-002, -0.900000000000000    ,   0.950000000000000   )  
! psample(10)=point( -0.200000000000000     , -0.854836158400380    ,    1.00000000000000   )  
! psample(11)=point( -0.200000000000000     , -0.850000000000000    ,   0.994360022196715   )  
! psample(12)=point( -0.150000000000000     , -0.850000000000000    ,   0.961399261429147   )  
! psample(13)=point( -0.150000000000000     , -0.886984682281087    ,    1.00000000000000   )  
! psample(14)=point( -0.100000000000000     , -0.850000000000000    ,   0.935842969580772   )  
! psample(15)=point( -0.100000000000000     , -0.869096596734014    ,   0.950000000000000   )  
! psample(16)=point( -0.127234953242779     , -0.850000000000000    ,   0.950000000000000   )  
! psample(17)=point( -5.000000000000004E-002, -0.850000000000000    ,   0.913941631504923   )

! allocate(psample(45))
! n=5
! psample(1)=point(   0.500000000000000   ,    0.683881294727325  ,    -0.400000000000000  )   
! psample(2)=point(   0.500000000000000   ,    0.642783385515213  ,    -0.300000000000000  )   
! psample(3)=point(   0.542783385515213   ,    0.600000000000000  ,    -0.300000000000000  )   
! psample(4)=point(   0.583881294727326   ,    0.600000000000000  ,    -0.400000000000000  )   
! psample(5)=point(   0.541940647363663   ,    0.641940647363663  ,    -0.400000000000000  )   
! psample(6)=point(   0.600000000000000   ,    0.583881294727326  ,    -0.400000000000000  )   
! psample(7)=point(   0.600000000000000   ,    0.600000000000000  ,    -0.425330376625061  )   
! psample(8)=point(   0.600000000000000   ,    0.542783385515213  ,    -0.300000000000000  )   
! psample(9)=point(   0.500000000000000   ,    0.700000000000000  ,    -0.425330376625061  )   
! psample(10)=point(  0.483881294727325   ,    0.700000000000000  ,    -0.400000000000000  )   
! psample(11)=point(  0.442783385515213   ,    0.700000000000000  ,    -0.300000000000000  )   
! psample(12)=point(  0.600000000000000   ,    0.690992438793182  ,    -0.400000000000000  )   
! psample(13)=point(  0.595496219396591   ,    0.695496219396591  ,    -0.400000000000000  )   
! psample(14)=point(  0.590992438793182   ,    0.700000000000000  ,    -0.400000000000000  )   
! psample(15)=point(  0.512490707635880   ,    0.600000000000000  ,    -0.200000000000000  )   
! psample(16)=point(  0.600000000000000   ,    0.512490707635880  ,    -0.200000000000000  )   
! psample(17)=point(  0.412490707635879   ,    0.700000000000000  ,    -0.200000000000000  )   
! psample(18)=point(  0.500000000000000   ,    0.612490707635880  ,    -0.200000000000000  )   
! psample(19)=point(  0.600000000000000   ,    0.700000000000000  ,    -0.382236552238464  )   
! psample(20)=point(  0.641940647363663   ,    0.541940647363663  ,    -0.400000000000000  )   
! psample(21)=point(  0.683881294727325   ,    0.500000000000000  ,    -0.400000000000000  )   
! psample(22)=point(  0.700000000000000   ,    0.500000000000000  ,    -0.425330376625061  )   
! psample(23)=point(  0.700000000000000   ,    0.590992438793182  ,    -0.400000000000000  )   
! psample(24)=point(  0.695496219396591   ,    0.595496219396591  ,    -0.400000000000000  )   
! psample(25)=point(  0.690992438793182   ,    0.600000000000000  ,    -0.400000000000000  )   
! psample(26)=point(  0.642783385515213   ,    0.500000000000000  ,    -0.300000000000000  )   
! psample(27)=point(  0.700000000000000   ,    0.600000000000000  ,    -0.382236552238464  )   
! psample(28)=point(  0.700000000000000   ,    0.632090348005295  ,    -0.300000000000000  )   
! psample(29)=point(  0.632090348005295   ,    0.700000000000000  ,    -0.300000000000000  )   
! psample(30)=point(  0.400000000000000   ,    0.800000000000000  ,    -0.425330376625061  )   
! psample(31)=point(  0.400000000000000   ,    0.783881294727325  ,    -0.400000000000000  )   
! psample(32)=point(  0.441940647363663   ,    0.741940647363663  ,    -0.400000000000000  )   
! psample(33)=point(  0.500000000000000   ,    0.790992438793182  ,    -0.400000000000000  )   
! psample(34)=point(  0.495496219396591   ,    0.795496219396591  ,    -0.400000000000000  )   
! psample(35)=point(  0.490992438793182   ,    0.800000000000000  ,    -0.400000000000000  )   
! psample(36)=point(  0.400000000000000   ,    0.742783385515213  ,    -0.300000000000000  )   
! psample(37)=point(  0.500000000000000   ,    0.800000000000000  ,    -0.382236552238464  )   
! psample(38)=point(  0.600000000000000   ,    0.732090348005295  ,    -0.300000000000000  )   
! psample(39)=point(  0.532090348005295   ,    0.800000000000000  ,    -0.300000000000000  )   
! psample(40)=point(  0.612490707635880   ,    0.500000000000000   ,   -0.200000000000000    ) 
! psample(41)=point(  0.400000000000000   ,    0.712490707635880   ,   -0.200000000000000    ) 
! psample(42)=point(  0.700000000000000   ,    0.662383025884628   ,   -0.200000000000000    ) 
! psample(43)=point(  0.662383025884628   ,    0.700000000000000   ,   -0.200000000000000    ) 
! psample(44)=point(  0.600000000000000   ,    0.762383025884628   ,   -0.200000000000000    ) 
! psample(45)=point(  0.562383025884628   ,    0.800000000000000   ,   -0.200000000000000    )
                                                                                         
                                                                                         
                                                                                         
! allocate(psample(19))
! n=4
! psample(1)=point(    -1.00000000000000  ,    -0.998099219799042    ,   0.400000000000000 )    
! psample(2)=point(    -1.00000000000000  ,     -1.00000000000000    ,   0.396461176872253 )    
! psample(3)=point(   -0.998099219799042  ,     -1.00000000000000    ,   0.400000000000000 )    
! psample(4)=point(   -0.999049609899521  ,    -0.999049609899521    ,   0.400000000000000 )    
! psample(5)=point(    -1.00000000000000  ,    -0.900000000000000    ,   0.415209031105041 )    
! psample(6)=point(   -0.900000000000000  ,     -1.00000000000000    ,   0.415209031105041 )    
! psample(7)=point(   -0.900000000000000  ,    -0.990988075733185    ,   0.400000000000000 )    
! psample(8)=point(   -0.945494037866592  ,    -0.945494037866592    ,   0.400000000000000 )    
! psample(9)=point(   -0.990988075733185  ,    -0.900000000000000    ,   0.400000000000000 )    
! psample(10)=point(  -0.900000000000000  ,    -0.949890166521072    ,   0.300000000000000 )    
! psample(11)=point(  -0.949890166521072  ,    -0.900000000000000    ,   0.300000000000000 )    
! psample(12)=point(  -0.890988075733185  ,     -1.00000000000000    ,   0.400000000000000 )    
! psample(13)=point(  -0.849890166521072  ,     -1.00000000000000    ,   0.300000000000000 )    
! psample(14)=point(   -1.00000000000000  ,    -0.849890166521072    ,   0.300000000000000 )    
! psample(15)=point(   -1.00000000000000  ,    -0.890988075733185    ,   0.400000000000000 )    
! psample(16)=point(  -0.900000000000000  ,    -0.919597488641739    ,   0.200000000000000 )    
! psample(17)=point(  -0.919597488641739  ,    -0.900000000000000    ,   0.200000000000000 )    
! psample(18)=point(  -0.819597488641739  ,     -1.00000000000000    ,   0.200000000000000 )    
! psample(19)=point(   -1.00000000000000  ,    -0.819597488641739    ,   0.200000000000000 )                                                                                        

! allocate(psample(13))
! n=3                                                                                      
! psample(1)=point(   0.989229995012283 ,     -0.200000000000000   ,    0.300000000000000     )
! psample(2)=point(   1.00000000000000  ,    -0.210770004987717    ,   0.300000000000000      )
! psample(3)=point(   1.00000000000000  ,    -0.200000000000000    ,   0.330676984786987      )
! psample(4)=point(   0.958937317132950 ,     -0.200000000000000   ,    0.200000000000000     )
! psample(5)=point(    1.00000000000000 ,     -0.241062682867050   ,    0.200000000000000     )
! psample(6)=point(   0.900000000000000 ,     -0.110770004987717   ,    0.300000000000000     )
! psample(7)=point(   0.900000000000000 ,     -0.141062682867050   ,    0.200000000000000     )
! psample(8)=point(   0.900000000000000 ,     -0.100000000000000   ,    0.330676984786987     )
! psample(9)=point(    1.00000000000000 ,     -0.169672095775604   ,    0.400000000000000     )
! psample(10)=point(  0.930327904224396 ,     -0.100000000000000   ,    0.400000000000000     )
! psample(11)=point(  0.858937317132950 ,     -0.100000000000000   ,    0.200000000000000     )
! psample(12)=point(  0.889229995012283 ,     -0.100000000000000   ,    0.300000000000000     )
! psample(13)=point(   1.00000000000000 ,     -0.100000000000000   ,    0.445393490791321     )                                                                  

! allocate(psample(13))
! n=3         
! psample(1)=point(   -1.00000000000000   ,    0.210770004987717   ,   -0.300000000000000   )  
! psample(2)=point(   -1.00000000000000   ,    0.200000000000000   ,   -0.330676984786987   )  
! psample(3)=point(  -0.989229995012283   ,    0.200000000000000   ,   -0.300000000000000   )  
! psample(4)=point(   -1.00000000000000   ,    0.169672095775604   ,   -0.400000000000000   )  
! psample(5)=point(  -0.930327904224396   ,    0.100000000000000   ,   -0.400000000000000   )  
! psample(6)=point(  -0.900000000000000   ,    0.100000000000000   ,   -0.330676984786987   )  
! psample(7)=point(  -0.900000000000000   ,    0.110770004987717   ,   -0.300000000000000   )  
! psample(8)=point(  -0.900000000000000   ,    0.141062682867050   ,   -0.200000000000000   )  
! psample(9)=point(  -0.958937317132950   ,    0.200000000000000   ,   -0.200000000000000   )  
! psample(10)=point(  -1.00000000000000   ,    0.241062682867050   ,   -0.200000000000000   )  
! psample(11)=point(  -1.00000000000000   ,    0.100000000000000   ,   -0.445393490791321   )  
! psample(12)=point( -0.889229995012283   ,    0.100000000000000   ,   -0.300000000000000   )  
! psample(13)=point( -0.858937317132950   ,    0.100000000000000   ,   -0.200000000000000   )



! allocate(psample(21))
! n=4 
! psample(1)=point(  -8.713049292564390E-002 , -1.00000000000000  ,    -0.400000000000000   )  
! psample(2)=point(  -5.806988179683684E-002 , -1.00000000000000  ,    -0.300000000000000   )  
! psample(3)=point(  -5.806988179683684E-002 ,-0.900000000000000  ,    -0.300000000000000   )  
! psample(4)=point(  -8.713049292564390E-002 ,-0.900000000000000  ,    -0.400000000000000   )  
! psample(5)=point(  -0.100000000000000      ,-0.900000000000000  ,    -0.427975440025330   )  
! psample(6)=point(  -0.100000000000000      , -1.00000000000000  ,    -0.427975440025330   )  
! psample(7)=point(  -0.100000000000000      ,-0.800000000000000  ,    -0.427975440025330   )  
! psample(8)=point(  -8.713049292564390E-002 ,-0.800000000000000  ,    -0.400000000000000   )  
! psample(9)=point(  -5.806988179683684E-002 ,-0.800000000000000  ,    -0.300000000000000   )  
! psample(10)=point( -3.664972186088561E-002 , -1.00000000000000  ,    -0.200000000000000   )  
! psample(11)=point( -3.664972186088561E-002 ,-0.900000000000000  ,    -0.200000000000000   )  
! psample(12)=point( -3.664972186088561E-002 ,-0.800000000000000  ,    -0.200000000000000   )  
! psample(13)=point( -0.162869507074356      , -1.00000000000000  ,    -0.400000000000000   )  
! psample(14)=point( -0.162869507074356      ,-0.900000000000000  ,    -0.400000000000000   )  
! psample(15)=point( -0.162869507074356      ,-0.800000000000000  ,    -0.400000000000000   )  
! psample(16)=point( -0.191930118203163      , -1.00000000000000  ,    -0.300000000000000   )  
! psample(17)=point( -0.191930118203163      ,-0.900000000000000  ,    -0.300000000000000   )  
! psample(18)=point( -0.191930118203163      ,-0.800000000000000  ,    -0.300000000000000   )  
! psample(19)=point( -0.200000000000000      ,-0.900000000000000  ,    -0.264503359794617   )  
! psample(20)=point( -0.200000000000000      , -1.00000000000000  ,    -0.264503359794617   )  
! psample(21)=point( -0.200000000000000      ,-0.800000000000000  ,    -0.264503359794617   )  

! allocate(psample(12))
! n=4 
! psample(1)=point(    1.00000000000000    ,  -0.100000000000000     ,  0.000000000000000E+000)
! psample(2)=point(   0.982167237997055    ,  -0.100000000000000     , -0.100000000000000     )
! psample(3)=point(   0.982167237997055    ,  -0.200000000000000     , -0.100000000000000     )
! psample(4)=point(    1.00000000000000    ,  -0.200000000000000     ,  0.000000000000000E+000)
! psample(5)=point(   0.963350278139114    ,  -0.300000000000000     , -0.200000000000000     )
! psample(6)=point(   0.982167237997055    ,  -0.300000000000000     , -0.100000000000000     )
! psample(7)=point(   0.963350278139114    ,  -0.200000000000000     , -0.200000000000000     )
! psample(8)=point(    1.00000000000000    ,  -0.300000000000000     ,  0.000000000000000E+000)
! psample(9)=point(   0.963350278139114    ,  -0.100000000000000     , -0.200000000000000     )
! psample(10)=point(  0.982167237997055    ,   0.000000000000000E+000, -0.100000000000000     )
! psample(11)=point(  0.963350278139114    ,   0.000000000000000E+000, -0.200000000000000     )
! psample(12)=point(   1.00000000000000    ,   0.000000000000000E+000,  0.000000000000000E+000)

! allocate(psample(12))
! n=4 
! psample(1)=point(    1.00000000000000    ,   -0.500000000000000    ,    0.000000000000000E+000  )
! psample(2)=point(   0.982279527187347    ,   -0.500000000000000    ,   -5.000000000000004E-002  )
! psample(3)=point(   0.982279527187347    ,   -0.550000000000000    ,   -5.000000000000004E-002  )
! psample(4)=point(    1.00000000000000    ,   -0.550000000000000    ,    0.000000000000000E+000  )
! psample(5)=point(   0.964334475994110    ,   -0.600000000000000    ,   -0.100000000000000       )
! psample(6)=point(   0.982279527187347    ,   -0.600000000000000    ,   -5.000000000000004E-002  )
! psample(7)=point(   0.964334475994110    ,   -0.550000000000000    ,   -0.100000000000000       )
! psample(8)=point(    1.00000000000000    ,   -0.600000000000000    ,    0.000000000000000E+000  )
! psample(9)=point(   0.964334475994110    ,   -0.500000000000000    ,   -0.100000000000000       )
! psample(10)=point(  0.982279527187347    ,   -0.450000000000000    ,   -5.000000000000004E-002  )
! psample(11)=point(  0.964334475994110    ,   -0.450000000000000    ,   -0.100000000000000       )
! psample(12)=point(   1.00000000000000    ,   -0.450000000000000    ,    0.000000000000000E+000  )
 
! allocate(psample(20))
! n=4 
! psample(1)=point(   -1.00000000000000    ,  -0.950000000000000   ,    0.000000000000000E+000)
! psample(2)=point(  -0.984057861566544    ,  -0.950000000000000   ,    5.000000000000004E-002)
! psample(3)=point(  -0.984057861566544    ,  -0.900000000000000   ,    5.000000000000004E-002)
! psample(4)=point(   -1.00000000000000    ,  -0.900000000000000   ,    0.000000000000000E+000)
! psample(5)=point(   -1.00000000000000    ,   -1.00000000000000   ,    0.000000000000000E+000)
! psample(6)=point(  -0.984057861566544    ,   -1.00000000000000   ,    5.000000000000004E-002)
! psample(7)=point(  -0.984057861566544    ,  -0.850000000000000   ,    5.000000000000004E-002)
! psample(8)=point(   -1.00000000000000    ,  -0.850000000000000   ,    0.000000000000000E+000)
! psample(9)=point(  -0.967952889204025    ,   -1.00000000000000   ,    0.100000000000000     )
! psample(10)=point( -0.967952889204025    ,  -0.950000000000000   ,    0.100000000000000     )
! psample(11)=point( -0.967952889204025    ,  -0.900000000000000   ,    0.100000000000000     )
! psample(12)=point( -0.967952889204025    ,  -0.850000000000000   ,    0.100000000000000     )
! psample(13)=point( -0.984057861566544    ,  -0.800000000000000   ,    5.000000000000004E-002)
! psample(14)=point(  -1.00000000000000    ,  -0.800000000000000   ,    0.000000000000000E+000)
! psample(15)=point( -0.967952889204025    ,  -0.800000000000000   ,    0.100000000000000     )
! psample(16)=point( -0.951506656408310    ,   -1.00000000000000   ,    0.150000000000000     )
! psample(17)=point( -0.951506656408310    ,  -0.950000000000000   ,    0.150000000000000     )
! psample(18)=point( -0.951506656408310    ,  -0.900000000000000   ,    0.150000000000000     )
! psample(19)=point( -0.951506656408310    ,  -0.850000000000000   ,    0.150000000000000     )
! psample(20)=point( -0.951506656408310    ,  -0.800000000000000   ,    0.150000000000000     )
 
! allocate(psample(32))
! n=4 
! psample(1)=point(   -0.102416384220123     ,  0.900000000000000 ,     -0.300000000000000     )
! psample(2)=point(  -0.100000000000000      , 0.900000000000000  ,    -0.293892621994019      )
! psample(3)=point(  -0.100000000000000      ,  1.00000000000000  ,    -0.293892621994019      )
! psample(4)=point(  -0.102416384220123      ,  1.00000000000000  ,    -0.300000000000000      )
! psample(5)=point(  -0.147583615779877      , 0.800000000000000  ,    -0.400000000000000      )
! psample(6)=point(  -0.102416384220123      , 0.800000000000000  ,    -0.300000000000000      )
! psample(7)=point(  -0.147583615779877      , 0.900000000000000  ,    -0.400000000000000      )
! psample(8)=point(  -0.100000000000000      , 0.800000000000000  ,    -0.293892621994019      )
! psample(9)=point(  -0.147583615779877      ,  1.00000000000000  ,    -0.400000000000000      )
! psample(10)=point( -6.549494266510009E-002 , 0.800000000000000  ,    -0.200000000000000      )
! psample(11)=point( -6.549494266510009E-002 , 0.900000000000000  ,    -0.200000000000000      )
! psample(12)=point( -6.549494266510009E-002 ,  1.00000000000000  ,    -0.200000000000000      )
! psample(13)=point( -3.204711079597473E-002 , 0.800000000000000  ,    -0.100000000000000      )
! psample(14)=point( -3.204711079597473E-002 , 0.900000000000000  ,    -0.100000000000000      )
! psample(15)=point( -3.204711079597473E-002 ,  1.00000000000000  ,    -0.100000000000000      )
! psample(16)=point( -0.200000000000000      , 0.800000000000000  ,    -0.475528264045715      )
! psample(17)=point( -0.200000000000000      , 0.700000000000000  ,    -0.475528264045715      )
! psample(18)=point( -0.147583615779877      , 0.700000000000000  ,    -0.400000000000000      )
! psample(19)=point( -0.102416384220123      , 0.700000000000000  ,    -0.300000000000000      )
! psample(20)=point( -0.200000000000000      , 0.900000000000000  ,    -0.475528264045715      )
! psample(21)=point( -0.200000000000000      ,  1.00000000000000  ,    -0.475528264045715     )
! psample(22)=point( -0.100000000000000      , 0.700000000000000  ,    -0.293892621994019     )
! psample(23)=point( -6.549494266510009E-002 , 0.700000000000000  ,    -0.200000000000000     )
! psample(24)=point( -3.204711079597473E-002 , 0.700000000000000  ,    -0.100000000000000     )
! psample(25)=point( -0.300000000000000      , 0.800000000000000  ,    -0.475528264045715     )
! psample(26)=point( -0.300000000000000      , 0.700000000000000  ,    -0.475528264045715     )
! psample(27)=point( -0.300000000000000      , 0.900000000000000  ,    -0.475528264045715     )
! psample(28)=point( -0.300000000000000      ,  1.00000000000000  ,    -0.475528264045715     )
! psample(29)=point(  0.000000000000000E+000 , 0.800000000000000  ,     0.000000000000000E+000)
! psample(30)=point(  0.000000000000000E+000 , 0.700000000000000  ,     0.000000000000000E+000)
! psample(31)=point(  0.000000000000000E+000 , 0.900000000000000  ,     0.000000000000000E+000)
! psample(32)=point(  0.000000000000000E+000 ,  1.00000000000000  ,     0.000000000000000E+000)

! allocate(psample(16))
! n=4 
! psample(1)=point(     1.00000000000000   ,    0.950000000000000  ,    -2.869022942143505E-002)
! psample(2)=point(   0.984163895330115    ,   0.950000000000000   ,   -5.000000000000004E-002 )
! psample(3)=point(   0.994157771757939    ,    1.00000000000000   ,   -5.000000000000004E-002 )
! psample(4)=point(    1.00000000000000    ,    1.00000000000000   ,   -4.311058298919448E-002 )
! psample(5)=point(   0.984163894673293    ,   0.900000000000000   ,   -5.000000000000004E-002 )
! psample(6)=point(   0.967867574095726    ,   0.900000000000000   ,   -0.100000000000000      )
! psample(7)=point(   0.967867574095726    ,   0.950000000000000   ,   -0.100000000000000      )
! psample(8)=point(    1.00000000000000    ,   0.900000000000000   ,   -2.869022812789450E-002 )
! psample(9)=point(   0.970283718963614    ,    1.00000000000000   ,   -0.100000000000000      )
! psample(10)=point(  0.967867574095726    ,   0.850000000000000   ,   -0.100000000000000      )
! psample(11)=point(  0.951478636217556    ,   0.850000000000000   ,   -0.150000000000000      )
! psample(12)=point(  0.951478636217556    ,   0.900000000000000   ,   -0.150000000000000      )
! psample(13)=point(  0.984163894673294    ,   0.850000000000000   ,   -5.000000000000004E-002 )
! psample(14)=point(  0.951478636217557    ,   0.950000000000000   ,   -0.150000000000000      )
! psample(15)=point(  0.951532495404627    ,    1.00000000000000   ,   -0.150000000000000      )
! psample(16)=point(   1.00000000000000    ,   0.850000000000000   ,   -2.869022812789502E-002 )

! allocate(psample(20))
! n=4 
! psample(1)=point(   0.963328424972399    ,   0.950000000000000     ,  5.000000000000004E-002  )
! psample(2)=point(     1.00000000000000   ,    0.950000000000000    ,   1.728569387610820E-003 )
! psample(3)=point(     1.00000000000000   ,     1.00000000000000    ,   9.526458421204984E-003 )
! psample(4)=point(    0.964682885120998   ,     1.00000000000000    ,   5.000000000000004E-002 )
! psample(5)=point(    0.963328420776487   ,    0.900000000000000    ,   5.000000000000004E-002 )
! psample(6)=point(     1.00000000000000   ,    0.900000000000000    ,   1.728570258675984E-003 )
! psample(7)=point(    0.950000000000000   ,    0.950000000000000    ,   7.793928701193398E-002 )
! psample(8)=point(    0.950000000000000   ,    0.900000000000000    ,   7.793927890759714E-002 )
! psample(9)=point(    0.950000000000000   ,     1.00000000000000    ,   7.794016769057768E-002 )
! psample(10)=point(   0.934856103245563   ,    0.900000000000000    ,   0.100000000000000      )
! psample(11)=point(   0.934856106343137   ,    0.950000000000000    ,   0.100000000000000      )
! psample(12)=point(   0.934910061515047   ,     1.00000000000000    ,   0.100000000000000      )
! psample(13)=point(   0.963328420776487   ,    0.850000000000000    ,   5.000000000000004E-002 )
! psample(14)=point(    1.00000000000000   ,    0.850000000000000    ,   1.728570258676219E-003 )
! psample(15)=point(   0.934856103245563   ,    0.850000000000000    ,   0.100000000000000      )
! psample(16)=point(   0.950000000000000   ,    0.850000000000000    ,   7.793927890759667E-002 )
! psample(17)=point(   0.903426146650937   ,    0.850000000000000    ,   0.150000000000000      )
! psample(18)=point(   0.903426146650937   ,    0.900000000000000    ,   0.150000000000000      )
! psample(19)=point(   0.903426148910229   ,    0.950000000000000    ,   0.150000000000000      )
! psample(20)=point(   0.903328346489229   ,     1.00000000000000    ,   0.150000000000000      )


! allocate(psample(30))
! n=4 
! psample(1)=point(   0.963328420776488   ,    0.600000000000000    ,   5.000000000000004E-002   )
! psample(2)=point(     1.00000000000000  ,     0.600000000000000   ,    1.728570258677122E-003  )
! psample(3)=point(     1.00000000000000  ,     0.650000000000000   ,    1.728570258676814E-003  )
! psample(4)=point(    0.963328420776487  ,     0.650000000000000   ,    5.000000000000004E-002  )
! psample(5)=point(    0.963328420776487  ,     0.550000000000000   ,    5.000000000000004E-002  )
! psample(6)=point(     1.00000000000000  ,     0.550000000000000   ,    1.728570258676586E-003  )
! psample(7)=point(     1.00000000000000  ,     0.700000000000000   ,    1.728570258676332E-003  )
! psample(8)=point(    0.963328420776487  ,     0.700000000000000   ,    5.000000000000004E-002  )
! psample(9)=point(    0.950000000000000  ,     0.600000000000000   ,    7.793927890759803E-002  )
! psample(10)=point(   0.950000000000000  ,     0.550000000000000   ,    7.793927890759683E-002  )
! psample(11)=point(   0.950000000000000  ,     0.650000000000000   ,    7.793927890759690E-002  )
! psample(12)=point(   0.950000000000000  ,     0.700000000000000   ,    7.793927890759586E-002  )
! psample(13)=point(   0.934856103245563  ,     0.550000000000000   ,    0.100000000000000       )
! psample(14)=point(   0.934856103245563  ,     0.600000000000000   ,    0.100000000000000       )
! psample(15)=point(   0.934856103245563  ,     0.650000000000000   ,    0.100000000000000       )
! psample(16)=point(   0.934856103245563  ,     0.700000000000000   ,    0.100000000000000       )
! psample(17)=point(   0.963328420776487  ,     0.500000000000000   ,    5.000000000000004E-002  )
! psample(18)=point(    1.00000000000000  ,     0.500000000000000   ,    1.728570258676649E-003  )
! psample(19)=point(   0.934856103245563  ,     0.500000000000000   ,    0.100000000000000       )
! psample(20)=point(   0.950000000000000  ,     0.500000000000000   ,    7.793927890759594E-002  )
! psample(21)=point(   1.00000000000000   ,    0.750000000000000     ,  1.728570258676821E-003     )
! psample(22)=point(  0.963328420776487   ,    0.750000000000000     ,  5.000000000000004E-002     )
! psample(23)=point(  0.950000000000000   ,    0.750000000000000     ,  7.793927890759547E-002     )
! psample(24)=point(  0.934856103245562   ,    0.750000000000000     ,  0.100000000000000          )
! psample(25)=point(  0.903426146650937   ,    0.500000000000000     ,  0.150000000000000          )
! psample(26)=point(  0.903426146650937   ,    0.550000000000000     ,  0.150000000000000          )
! psample(27)=point(  0.903426146650936   ,    0.600000000000000     ,  0.150000000000000          )
! psample(28)=point(  0.903426146650936   ,    0.650000000000000     ,  0.150000000000000          )
! psample(29)=point(  0.903426146650937   ,    0.700000000000000     ,  0.150000000000000          )
! psample(30)=point(  0.903426146650937   ,    0.750000000000000     ,  0.150000000000000          )


allocate(psample(10))

psample(1)=point(  -0.757957362369288   ,   -0.274779717379982   ,   -0.134031289838452   )  
psample(2)=point(  -0.758160998975375   ,   -0.274891410115130   ,   -0.134163064886695   )  
psample(3)=point(  -0.757946498531370   ,   -0.274833083707620   ,   -0.134188784456436   )  
psample(4)=point(  -0.759625142386271   ,   -0.276510313838947   ,   -0.137971642677392   )  
psample(5)=point(  -0.757708782464838   ,   -0.275985018106859   ,   -0.138495639572397   )  
psample(6)=point(  -0.754393019262266   ,   -0.274924866392430   ,   -0.137709940950102   )  
psample(7)=point(  -0.754860269699941   ,   -0.274030843571714   ,   -0.134187183659386   )  
psample(8)=point(  -0.755912806051942   ,   -0.273006443288698   ,   -0.130422198412812   )  
psample(9)=point(  -0.755125192339520   ,   -0.272786925139633   ,   -0.130324868089464   )  
psample(10)=point( -0.755422451861207   ,   -0.272648600661866   ,   -0.129793157274186   )  


!allocate(psample1,source=pack(psample,abs(psample%x-1d0)>1d-4 .and. abs(psample%y-1d0)>1d-4))

!call move_Alloc(psample1,psample)

origin = sum(psample)/size(psample)
print *, "R=",sum(norm(psample-O))/size(psample),"K=",2d0/(sum(norm(psample-O))/size(psample))
!psample%z=psample%x**2+psample%y**2

!allocate(gridp,source=((/mid,psample(4:23)/)))
!allocate(gridp,source=(/psample(4:23)/))

!call move_alloc(gridp,psample)

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 mid = sum(psample(1:n))/n
! 
! !unit_w=unit((psample(2)-mid).x.(psample(1)-mid))
! !unit_w=vector(-0.284766880113168   ,    0.703720610245964    ,   0.650910997530124)
 unit_w = vec0
 do i=1,n-1
   unit_v = (psample(i)-mid).x.(psample(i+1)-mid) ! not unit yet
   unit_w = unit_w + unit(unit_v)
 end do
 unit_v = (psample(n)-mid).x.(psample(1)-mid) ! not unit yet
 unit_w = unit_w + unit(unit_v)
 unit_w = unit(unit_w/n)
 !unit_w =kk
 !unit_w =unit(vector(   0.902559317671733   ,   -7.276507537985022E-008 , 0.430565532856417       ))
 !unit_w = unit(vector(-0.951512945451134   ,    0.000000000000000E+000 , 0.307608703776254))
 !unit_w = unit(vector(-0.856406853182581   ,    0.000000000000000E+000,  0.516301560933055))
 !unit_w = unit(vector(-0.928266724356739   ,   -6.214277096016912E-015  ,0.371915162976734))
 !d_max=0.1
 !d_min=0.1
 !unit_w = unit(unit_w+d_min*ii+d_max*jj) 
 !unit_w = unit(kk)
 ! unit_w = ii
 !unit_w = unit(vector( -0.660219110752635 ,     -0.660219110752631     ,  0.358080230666265))
 !unit_w=kk
 !unit_v = sum(unit(psample-origin))/size(psample)
 !unit_w = unit(sign(1d0,unit_w*unit_v)*unit_v)
 !unit_w = kk
 !unit_w = unit(vector(-0.686276087261647  ,    -0.686276087261643    ,   0.240936224145922))
 i=2
 !unit_v=((psample(i)-mid)-((psample(i)-mid)*unit_w)*unit_w)/sqrt(norm2(psample(i)-mid)-((psample(i)-mid)*unit_w)**2)
 !unit_v=unit((psample(i)-mid)-((psample(i)-mid)*unit_w)*unit_w)
 !unit_v=unit((origin-mid)-((origin-mid)*unit_w)*unit_w)
 !unit_v=unit((mid-origin)-((mid-origin)*unit_w)*unit_w)
 !unit_v=(((psample(i)+psample(i+1))/2d0-mid)-(((psample(i)+psample(i+1))/2d0-mid)*unit_w)*unit_w)/sqrt(norm2((psample(i)+psample(i+1))/2d0-mid)-(((psample(i)+psample(i+1))/2d0-mid)*unit_w)**2)
 unit_v=unit(sum((psample-mid)-((psample-mid)*unit_w)*unit_w))
 !unit_v = jj
 !unit_v=jj
 !unit_v=jj
 !unit_v=jj
 !unit_v= (-1d0)*jj
 !unit_v=unit(sum((psample-origin)-((psample-origin)*unit_w)*unit_w)/size(psample))
 unit_u=unit(unit_v.x.unit_w)
 !unit_u=(-1d0)*unit(unit_v.x.unit_w)
 !unit_u=ii
 !unit_u=ii
 !unit_u=kk
 !origin = mid + unit_w*(-norm(mid-origin))
 
 !d_min=0.25
 !unit_v=cos(d_min*pi)*unit_v+(-sin(d_min*pi))*unit_u
 !unit_u=unit(unit_v.x.unit_w)
 
 !d_min=0d0
 !unit_w=cos(d_min*pi)*unit_w+(-sin(d_min*pi))*unit_v
 !unit_v=unit(unit_w.x.unit_u)
 
 !unit_u=ii
 !unit_v=jj
 !unit_w=kk
 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!
!mid=sum(psample)/24
!print *, mid
!
!unit_w=unit(sum(unit(psample-mid))/24)
!
!allocate(loc,source=minloc(abs((psample-mid)*unit_w)))
!
!i=loc(1)
!unit_v=((psample(i)-mid)-((psample(i)-mid)*unit_w)*unit_w)/sqrt(norm2(psample(i)-mid)-((psample(i)-mid)*unit_w)**2)
!unit_u=unit(unit_v.x.unit_w)
!
!
!
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
print *, " New Coord Stuff"
!origin=mid
print *, norm(origin-mid)
print *, mid
print *, unit_u
print *, unit_v
print *, unit_W
print *, unit_w*unit_v, norm(unit_w)
!print *, ii.x.jj, ortho2orxtho(unit_u.x.unit_v,unit_u,unit_v,unit_w)
print *, unit_w*unit_u, norm(unit_u)
!print *, jj.x.kk, ortho2ortho(unit_v.x.unit_w,unit_u,unit_v,unit_w)
print *, unit_u*unit_v, norm(unit_v)
!print *, kk.x.ii, ortho2ortho(unit_w.x.unit_u,unit_u,unit_v,unit_w)

allocate(rem(size(psample)),source=.false.)
! rem=.true.
! rem(4)=.false.
! rem(5)=.false.
! rem(22)=.false.
! rem(23)=.false.
! rem(13)=.false.
! rem(14)=.false.

! good for sample 4
! rem(1:3) = .true.
! rem(6) = .true.
! rem(15) = .true.
! rem(26) = .true.

! good also for sample 4
! rem(1:6) = .true.
! rem(15:16) = .true.
! rem(15:19) = .true.
! rem(25:26) = .true.
! rem(28) = .true.

rem(1:7) = .true.
!rem(8) = .true.
!rem(12) = .true.
!rem(18) = .true.
!rem(21) = .true.
!rem(22) = .true.
!rem(25) = .true.
!rem(1:6) = .true.
!rem(8:25) = .true.
!rem(1:25) = .true.

!rem(6:8) = .true.
!rem(11:12)=.true.
!rem(14:15)=.true.
!rem(17)=.true.
!rem(20:22)=.true.
!rem(24)=.true.
!rem(26)=.true.
!rem(29:30)=.true.

!rem(10)=.true.
!rem(18)=.true.
!rem(23)=.true.
! rem(24:25) = .true.
!rem(10:20) = .true.
!rem=.true.

!allocate(gridp,source=pack(psample,rem))

!call move_alloc(gridp,psample)
!

method=2


if (method==1) then

allocate(psample1(size(psample)))

psample1=ortho2ortho(psample,mid,unit_u,unit_v,unit_w) 
psample1%z=0d0
! x
call myfit%set(poly3D)

call myfit%set(cubic_xy)
!call myfit%set(idist3)

call myfit%solve(psample1,psample%x,sf1)
print*, sf1
print*, " c="
print*, myfit%coeffs


! y
call myfity%set(poly3D)

call myfity%set(cubic_xy)
!call myfity%set(idist3)

call myfity%solve(psample1,psample%y,sf2)

print*, sf2
print*, " c="
print*, myfity%coeffs

! z
call myfitz%set(poly3D)

call myfitz%set(cubic_xy)
!call myfitz%set(idist3)

call myfitz%solve(psample1,psample%z,sf3)

print*, sf3
print*, " c="
print*, myfitz%coeffs

! gradients
gradfit  = myfit%gradient(O)
gradfity = myfity%gradient(O)
gradfitz = myfitz%gradient(O)

r_u = vector(gradfit%vx,gradfity%vx,gradfitz%vx)
r_v = vector(gradfit%vy,gradfity%vy,gradfitz%vy)

mE=norm2(r_u)
mF=r_u*r_v
mG=norm2(r_v)

U=unit(r_u.x.r_v)

print *,"U=", U
print *,"Du=", norm(U-unit_W)

Hess  = myfit %hessian(O)
Hessy = myfity%hessian(O)
Hessz = myfitz%hessian(O)

r_uu = vector(Hess(1),Hessy(1),Hessz(1))
r_uv = vector(Hess(2),Hessy(2),Hessz(2))
r_vv = vector(Hess(4),Hessy(4),Hessz(4))

mL = r_uu*U
mM = r_uv*U
mN = r_vv*U

 curvature = (mE*mN-2d0*mF*mM+mG*mL)/(mE*mG-mF**2)

 print *, "curv=", curvature
 
! uv grid
mid=point(minval(psample1%x),minval(psample1%y),0d0)

allocate(gridp,source=make_grid(mid,ii,jj,maxval(abs(mid%x-psample1%x)),maxval(abs(mid%y-psample1%y)),200,200))

open(100,file="fort.m")
write(100,*), 'sps=['
write(100,*), psample
write(100,*), ']'
!gridp=myfit%seval(gridp)
write(100,*), 'fps=['
write(100,*), gridp
write(100,*), ']'
close(100) 

else if (method==2) then
print *, size(psample)

!allocate(b_source(size(psample)),source=1d0)
!where(abs(psample%x-1d0)<1d-4 .or. abs(psample%y-1d0)<1d-4) b_source=1d0

!psample=pack(psample,abs(psample%x-1d0)>1d-4 .and. abs(psample%y-1d0)>1d-4)

psample=ortho2ortho(psample,mid,unit_u,unit_v,unit_w) 


!print *, psample

d_min = minval(psample%x**2+psample%y**2)
d_max = maxval(psample%x**2+psample%y**2)
d_mean = sum(psample%x**2+psample%y**2)/size(psample)
d_eff=d_mean

print *, 'd_min =', d_min
print *, 'd_mean=', d_mean
print *, 'd_max =', d_max

print *, "cnt of < d_mean", count(psample%x**2+psample%y**2>d_eff)

!allocate(gridp,source=pack(psample,psample%x**2+psample%y**2>d_eff))

!call move_alloc(gridp,psample)
!print *, "mean dist",sum(sqrt(psample%x**2+psample%y**2))/size(psample)
!print *, "max  dist",maxval(sqrt(psample%x**2+psample%y**2))
!print *, "min  dist",minval(sqrt(psample%x**2+psample%y**2))

!unit_w=kk
!unit_v=jj
!unit_u=ii

! basis functions to be used for the fit
poly3D%e=0d0
call myfit%set(poly3D)
! remove z-terms
!call myfit%set(linear_xy)
!call myfit%set(quadratic_xy)
call myfit%set(linear_xy)
!call myfit%set(bicubic_xy)
!call myfit%set(fourth_xy)
!call myfit%set(quad_onlysq_xy)
!mid = sum(psample(1:3))/3

!mid%z=0d0
!call myfit%set(mid)

!gaussw%l=sum(sqrt(psample%x**2+psample%y**2))/size(psample)
gaussw%l=0.5*sqrt(sum((norm(psample-O)-sum(norm(psample-O))/size(psample))**2)/(size(psample)*(size(psample)-1)))
print *, gaussw%l

!gaussw%l=sqrt(sum((sqrt(psample%x**2+psample%y**2)-gaussw%l)**2)/(size(psample)*(size(psample)-1)))

!call myfit%set(gaussw)
i2ddist2%n=2
!call myfit%set(i2ddist2)
!call myfit%set(idist3,.true.)
!idistn%n=-4
!call myfit%set(idistn)
!gaussw%l=maxval(norm(psample-O))
!print *, gaussw%l
!call myfit%set(gaussw)

! evaluate lsq fit
!call myfit%fsolve(psample,psample%z)
! allocate(b_source(size(myfit%keep)))
! do i=1,size(b_source)
!   !             2* h  * a
!   b_source(i)=2d0*0.05*0.02*sum(myfit%base%basis(myfit%keep(i),psample-O))
! end do

psample%x=psample%x
psample%y=psample%y

!psample%x=(psample%x-minval(psample%x))/(maxval(psample%x)-minval(psample%x))
!psample%y=(psample%y-minval(psample%y))/(maxval(psample%y)-minval(psample%y))


!call myfit%solve(psample,psample%z,rhs_source=b_source)
call myfit%solve(psample,psample%z)!,weights=b_source)

mid=O!+myfit%seval(O)*kk

gradfit=myfit%gradient(O)

gradfit%vx=-gradfit%vx
gradfit%vy=-gradfit%vy
gradfit%vz=1d0

print *, "lin stats="
print *, " min=" ,minval(gradfit*(psample-mid))/0.05
print *, " mean=",sum(abs(gradfit*(psample-mid)))/size(psample)
print *, " mean=",maxval(gradfit*(psample-mid))

! myfit%coeffs=(/    -2.431144538223454e-04 ,&
!     -2.343644132678267e-03,&
!      1.925470987547441e-03,&
!     -5.049166084797631e-03,&
!     -5.815150515530933e-04,&
!     -1.552810167138596e-03,&
!     -1.225435250869157e-03,&
!     -1.266189611770654e-03,&
!      3.170127638274360e-05,&
!      4.331092747362777e-04/)
!  myfit%coeffs=(/ &
!      1.800584110844286e-02,&
!      2.518170915122585e-01,&
!     -5.224668200885509e-02,&
!     -2.365390020808179e-01,&
!      6.912368338567678e-01,&
!      5.176714778223351e-02,&
!     -7.636104153585747e+00,&
!     -9.662351361562658e+00,&
!     -4.053688965571646e+00,&
!      5.254289249043493e+00/)
gradfit = myfit%gradient(O)
Hess = myfit%hessian(O)
!gradfit = myfit%gradient(mid)
!Hess = myfit%hessian(mid)

 area_sumparts = sqrt(gradfit%vx**2+gradfit%vy**2+1d0)

 curvature = (-Hess(1)*(gradfit%vy**2 + 1d0)-Hess(4)*(gradfit%vx**2 + 1d0)+2d0*gradfit%vx*gradfit%vy*Hess(2)) &
                    / (area_sumparts**3d0)
print *, "curv=",curvature
print *, "Err Sum", myfit%rsumE2(psample,psample%z)


call myfit%set(quadratic_xy)
call myfit%solve(psample,psample%z)!,weights=b_source)

gradfit = myfit%gradient(O)
Hess = myfit%hessian(O)
!gradfit = myfit%gradient(mid)
!Hess = myfit%hessian(mid)

 area_sumparts = sqrt(gradfit%vx**2+gradfit%vy**2+1d0)

 curvature = (-Hess(1)*(gradfit%vy**2 + 1d0)-Hess(4)*(gradfit%vx**2 + 1d0)+2d0*gradfit%vx*gradfit%vy*Hess(2)) &
                    / (area_sumparts**3d0)
print *, "curv=",curvature
print *, "Err Sum", myfit%rsumE2(psample,psample%z)



! allocate(b_source(size(myfit%keep)))
! do i=1,size(b_source)
!   !             2* h  * a
!   b_source(i)=2d0*sum((psample%z-myfit%seval(psample))*myfit%base%basis(myfit%keep(i),psample-O))
! end do
call myfit%set(cubic_xy)
call myfit%solve(psample,psample%z)!,weights=b_source)!,rhs_source=b_source)

!call myfit%solve(psample)
!call myfit%solve(psample,psample%z)
!call myfit%solve(psample,psample%z-mid%z)
!allocate(f(size(psample)),source=0d0)
!psample%z=0d0
!call myfit%solve(psample,f)

print *, "Err Sum", myfit%rsumE2(psample,psample%z)
!print *, myfit%rsumE2(psample,psample%z-mid%z)

!mid=psample(24)

 csum=0d0

!call myfit%set(quadratic_xy)
!do i=1,size(psample)
!gradfit = myfit%gradient(psample(i))
!Hess = myfit%hessian(psample(i))
!gradfit = myfit%gradient(mid)
!Hess = myfit%hessian(mid)
!mid = ortho2ortho(mid,origin,unit_u,unit_v,unit_w)
gradfit = myfit%gradient(O)
Hess = myfit%hessian(O)
!gradfit = myfit%gradient(mid)
!Hess = myfit%hessian(mid)

 area_sumparts = sqrt(gradfit%vx**2+gradfit%vy**2+1d0)

 curvature = (-Hess(1)*(gradfit%vy**2 + 1d0)-Hess(4)*(gradfit%vx**2 + 1d0)+2d0*gradfit%vx*gradfit%vy*Hess(2)) &
                    / (area_sumparts**3d0)

!print *, norm(mid-psample(i)),curvature
print *, "curv=",curvature
print *, ((1+myfit%coeffs(3)**2)*2*myfit%coeffs(5)-2d0*myfit%coeffs(2)*myfit%coeffs(3)*myfit%coeffs(4)+(1+myfit%coeffs(2)**2)*2*myfit%coeffs(6))/(1+myfit%coeffs(3)**2+myfit%coeffs(2)**2)**(3d0/2)
!print *, "curv_c=",(4d0*myfit%coeffs(5)*myfit%coeffs(6)-myfit%coeffs(4))/(myfit%coeffs(2)**2+myfit%coeffs(3)**2+1d0)
! csum=csum+curvature
!end do

! print*, csum/size(psample)


!print *, norm(psample-O)
mid=point(minval(psample%x),minval(psample%y),0d0)

allocate(gridp,source=make_grid(mid,ii,jj,maxval(abs(mid%x-psample%x)),maxval(abs(mid%y-psample%y)),200,200))

open(100,file="fort.m")
write(100,*), 'sps=['
write(100,*), psample
write(100,*), ']'
gridp%z=myfit%seval(gridp)
write(100,*), 'fps=['
write(100,*), gridp
write(100,*), ']'
close(100) 

print*, "Coef="
print*, myfit%coeffs
print*, "norm="
print*, unit((-gradfit%vx)*unit_u+(-gradfit%vy)*unit_v+unit_w)

!do i=1,size(psample)
!print *,sqrt(psample(i)%x**2+psample(i)%y**2), psample(i)%z-myfit%seval(psample(i))
!end do


else if (method==3) then

allocate(psample1(size(psample)))

! find LSq plane
psample1=ortho2ortho(psample,mid,unit_u,unit_v,unit_w) 

call myfit%set(poly3D)
call myfit%set(cubic_xy)

! vector approximation
call myfit%solve(psample1,psample-O)

! curvature calculation

gradfit  = myfit%gradient_x(O)
gradfity = myfit%gradient_y(O)
gradfitz = myfit%gradient_z(O)

r_u = vector(gradfit%vx,gradfity%vx,gradfitz%vx)
r_v = vector(gradfit%vy,gradfity%vy,gradfitz%vy)

mE=norm2(r_u)
mF=r_u*r_v
mG=norm2(r_v)

U=unit(r_u.x.r_v)

print *,"U=", U
print *,"Du=", norm(U-unit_W)

Hess  = myfit%hessian_x(O)
Hessy = myfit%hessian_y(O)
Hessz = myfit%hessian_z(O)

r_uu = vector(Hess(1),Hessy(1),Hessz(1))
r_uv = vector(Hess(2),Hessy(2),Hessz(2))
r_vv = vector(Hess(4),Hessy(4),Hessz(4))

mL = r_uu*U
mM = r_uv*U
mN = r_vv*U

 curvature = (mE*mN-2d0*mF*mM+mG*mL)/(mE*mG-mF**2)

 print *, "curv=", curvature
 
! uv grid
mid=point(minval(psample1%x),minval(psample1%y),0d0)

allocate(gridp,source=make_grid(mid,ii,jj,maxval(abs(mid%x-psample1%x)),maxval(abs(mid%y-psample1%y)),200,200))

open(100,file="fort.m")
write(100,*), 'sps=['
write(100,*), psample
write(100,*), ']'
gridp=O+myfit%veval(gridp)
write(100,*), 'fps=['
write(100,*), gridp
write(100,*), ']'
close(100) 

else if (method==4) then

allocate(psample1(size(psample)))

mid=sum(psample)/size(psample)
unit_u=ii
unit_v=jj
unit_w=kk

! find LSq plane
psample1=ortho2ortho(psample,mid,unit_u,unit_v,unit_w) 

call myfit%set(poly3D)
call myfit%set(linear_xy)

! vector approximation
call myfit%solve(psample1,psample-O)

! curvature calculation

gradfit  = myfit%gradient_x(O)
gradfity = myfit%gradient_y(O)
gradfitz = myfit%gradient_z(O)

r_u = vector(gradfit%vx,gradfity%vx,gradfitz%vx)
r_v = vector(gradfit%vy,gradfity%vy,gradfitz%vy)

mE=norm2(r_u)
mF=r_u*r_v
mG=norm2(r_v)

U=unit(r_u.x.r_v)

print *,"U=", U

unit_w=U
unit_v=unit(sum((psample-mid)-((psample-mid)*unit_w)*unit_w))
unit_u=unit(unit_v.x.unit_w)

psample1=ortho2ortho(psample,mid,unit_u,unit_v,unit_w) 

call myfit%set(poly3D)
call myfit%set(cubic_xy)

! vector approximation
call myfit%solve(psample1,psample-O)

! curvature calculation

gradfit  = myfit%gradient_x(O)
gradfity = myfit%gradient_y(O)
gradfitz = myfit%gradient_z(O)

r_u = vector(gradfit%vx,gradfity%vx,gradfitz%vx)
r_v = vector(gradfit%vy,gradfity%vy,gradfitz%vy)

mE=norm2(r_u)
mF=r_u*r_v
mG=norm2(r_v)

U=unit(r_u.x.r_v)

print *,"U=", U
print *,"Du=", norm(U-unit_W)

Hess  = myfit%hessian_x(O)
Hessy = myfit%hessian_y(O)
Hessz = myfit%hessian_z(O)

r_uu = vector(Hess(1),Hessy(1),Hessz(1))
r_uv = vector(Hess(2),Hessy(2),Hessz(2))
r_vv = vector(Hess(4),Hessy(4),Hessz(4))

mL = r_uu*U
mM = r_uv*U
mN = r_vv*U

 curvature = (mE*mN-2d0*mF*mM+mG*mL)/(mE*mG-mF**2)

 print *, "curv=", curvature
 
! uv grid
mid=point(minval(psample1%x),minval(psample1%y),0d0)

allocate(gridp,source=make_grid(mid,ii,jj,maxval(abs(mid%x-psample1%x)),maxval(abs(mid%y-psample1%y)),200,200))

open(100,file="fort.m")
write(100,*), 'sps=['
write(100,*), psample
write(100,*), ']'
gridp=O+myfit%veval(gridp)
write(100,*), 'fps=['
write(100,*), gridp
write(100,*), ']'
close(100) 

else if (method==5) then
! 
! allocate(psample1(size(psample)+12))
! psample1(1:size(psample))=psample 
! psample1(size(psample)+1)=point( 0.982002827523349     ,  0.975000000000000     ,  2.781375695220397E-002   )
! psample1(size(psample)+2)=point(  0.981664211437222    ,   0.925000000000000    ,   2.586428491157172E-002  )
! psample1(size(psample)+3)=point(  0.942428052397175    ,   0.925000000000000    ,   8.896964147988282E-002  )
! psample1(size(psample)+4)=point(  0.956664211437221    ,   0.925000000000000    ,   6.396964147988279E-002  )
! psample1(size(psample)+5)=point(  0.942441541964546    ,   0.975000000000000    ,   8.896986367562795E-002  )
! psample1(size(psample)+6)=point(  0.957002827523349    ,   0.975000000000000    ,   6.396986367562793E-002  )
! psample1(size(psample)+7)=point(  0.981664210388243    ,   0.875000000000000    ,   2.586428512933807E-002  )
! psample1(size(psample)+8)=point(  0.942428051622782    ,   0.875000000000000    ,   8.896963945379849E-002  )
! psample1(size(psample)+9)=point(  0.956664210388243    ,   0.875000000000000    ,   6.396963945379847E-002  )
! psample1(size(psample)+10)=point(  0.919141124948250   ,    0.875000000000000   ,    0.125000000000000       )
! psample1(size(psample)+11)=point(  0.919141126287466   ,    0.925000000000000   ,    0.125000000000000       )
! psample1(size(psample)+12)=point(  0.919130165814411   ,    0.975000000000000   ,    0.125000000000000       )

! allocate(nsample(12))
! nsample(1) =vector(   0.774591801088003   ,  -5.954696263173074E-002  , 0.629652047506064       )
! nsample(2) =vector(   0.796279075053356   ,   -2.814183920551836E-008 , 0.604929445995292       )
! nsample(3) =vector(   0.824440336052967   ,   -7.140405086545739E-008 , 0.565948877805113       )
! nsample(4) =vector(   0.902559317671733   ,   -7.276507537985022E-008 , 0.430565532856417       )
! nsample(5) =vector(   0.824905501749592   ,   -4.500573543374178E-004 , 0.565270475641203       )
! nsample(6) =vector(   0.893945239336704   ,   -1.211119049434315E-002 , 0.448012531222122       )
! nsample(7) =vector(   0.796279055754038   ,   -1.242997365754102E-015 , 0.604929471399318       )
! nsample(8) =vector(   0.824440357550946   ,   -4.502581536459855E-015 , 0.565948846488151       )
! nsample(9) =vector(   0.902559319741493   ,   -5.039137069581336E-015 , 0.430565528517756       )
! nsample(10)=vector(   0.846625981548127   ,   -4.699718289803051E-015 , 0.532188357038812       )
! nsample(11)=vector(   0.846625978350420   ,   -4.535261500530092E-008 , 0.532188362125848       )
! nsample(12)=vector(   0.846047116923420   ,    3.709680810047105E-004 , 0.533107998747207       )
! 

allocate(psample1,source=ortho2ortho(psample,mid,unit_u,unit_v,unit_w))

call myfit%set(poly3D)
! remove z-terms
!call myfit%set(linear_xy)
!call myfit%set(quadratic_xy)
call myfit%set(linear_xy)

call myfit%solve(psample1,psample1%z)

gradfit=myfit%gradient(O)

! new unit_w : normal to fitting surface in Oijk
unit_w=unit((-gradfit%vx)*unit_u+(-gradfit%vy)*unit_v+unit_w)
print *, "unit_w=",unit_w
unit_v=unit(sum((psample-mid)-((psample-mid)*unit_w)*unit_w))

unit_u=unit_v.x.unit_w

deallocate(psample1)

! add points to psample
allocate(psample1(size(psample)+20))
psample1(1:size(psample))=psample 
psample1(size(psample)+1)=point(   0.981664210388244    ,   0.625000000000000     ,  2.586428512933851E-002   )
psample1(size(psample)+2)=point(   0.981664210388244    ,   0.575000000000000     ,  2.586428512933845E-002   )
psample1(size(psample)+3)=point(   0.981664210388243    ,   0.675000000000000     ,  2.586428512933831E-002   )
psample1(size(psample)+4)=point(   0.942428051622781    ,   0.575000000000000     ,  8.896963945379877E-002   )
psample1(size(psample)+5)=point(   0.956664210388244    ,   0.575000000000000     ,  6.396963945379874E-002   )
psample1(size(psample)+6)=point(   0.942428051622782    ,   0.625000000000000     ,  8.896963945379878E-002   )
psample1(size(psample)+7)=point(   0.956664210388244    ,   0.625000000000000     ,  6.396963945379876E-002   )
psample1(size(psample)+8)=point(   0.942428051622781    ,   0.675000000000000     ,  8.896963945379824E-002   )
psample1(size(psample)+9)=point(   0.956664210388244    ,   0.675000000000000     ,  6.396963945379822E-002   )
psample1(size(psample)+10)=point(  0.981664210388243    ,   0.525000000000000     ,  2.586428512933833E-002   )
psample1(size(psample)+11)=point(  0.942428051622781    ,   0.525000000000000     ,  8.896963945379824E-002   )
psample1(size(psample)+12)=point(  0.956664210388243    ,   0.525000000000000     ,  6.396963945379822E-002   )
psample1(size(psample)+13)=point(   0.981664210388243   ,    0.725000000000000    ,   2.586428512933831E-002  )
psample1(size(psample)+14)=point(   0.942428051622781   ,    0.725000000000000    ,   8.896963945379788E-002  )
psample1(size(psample)+15)=point(   0.956664210388243   ,    0.725000000000000    ,   6.396963945379786E-002  )
psample1(size(psample)+16)=point(   0.919141124948250   ,    0.525000000000000    ,   0.125000000000000       )
psample1(size(psample)+17)=point(   0.919141124948250   ,    0.575000000000000    ,   0.125000000000000       )
psample1(size(psample)+18)=point(   0.919141124948250   ,    0.625000000000000    ,   0.125000000000000       )
psample1(size(psample)+19)=point(   0.919141124948250   ,    0.675000000000000    ,   0.125000000000000       )
psample1(size(psample)+20)=point(   0.919141124948250   ,    0.725000000000000    ,   0.125000000000000       )

! generate normal sample
allocate(nsample(20))
nsample(1) =vector(    0.796279055754038   ,    5.392283536329054E-015 , 0.604929471399317            )
nsample(2) =vector(    0.796279055754038   ,   -9.443203008894578E-015 , 0.604929471399318            )
nsample(3) =vector(    0.796279055754036   ,    8.227032924415688E-015 , 0.604929471399320            )
nsample(4) =vector(    0.824440357550938   ,   -9.501510643868192E-015 , 0.565948846488162            )
nsample(5) =vector(    0.902559319741489   ,   -1.215347046494993E-014 , 0.430565528517764            )
nsample(6) =vector(    0.824440357550937   ,    1.001811729934500E-014 , 0.565948846488164            )
nsample(7) =vector(    0.902559319741487   ,    8.843663666858363E-015 , 0.430565528517768            )
nsample(8) =vector(    0.824440357550943   ,    8.630370009142150E-015 , 0.565948846488155            )
nsample(9) =vector(    0.902559319741487   ,    1.048981096326411E-014 , 0.430565528517767            )
nsample(10)=vector(    0.796279055754035   ,   -1.395018626313962E-015 , 0.604929471399321            )
nsample(11)=vector(    0.824440357550945   ,   -7.769358916680793E-015 , 0.565948846488152            )
nsample(12)=vector(    0.902559319741489   ,   -5.827186307222256E-015 , 0.430565528517764            )
nsample(13)=vector(    0.796279055754034   ,   -3.836301222363389E-015 , 0.604929471399323      )
nsample(14)=vector(    0.824440357550946   ,    4.948281396086632E-015 , 0.565948846488151      )
nsample(15)=vector(    0.902559319741487   ,    6.742199033149860E-016 , 0.430565528517768      )
nsample(16)=vector(    0.846625981548133   ,    9.362720030467131E-016 , 0.532188357038804      )
nsample(17)=vector(    0.846625981548126   ,    2.808816009140083E-015 , 0.532188357038815      )
nsample(18)=vector(    0.846625981548124   ,    2.808816009140092E-015 , 0.532188357038818      )
nsample(19)=vector(    0.846625981548129   ,   -1.890902280662943E-015 , 0.532188357038809      )
nsample(20)=vector(    0.846625981548134   ,    3.763446286756360E-015 , 0.532188357038802     )


call myfit%set(poly3D)
call myfit%set(quadratic)
call myfit%solve(psample1(size(psample)+1:),nsample)

gradfit =myfit%gradient_x(mid)
gradfity=myfit%gradient_y(mid)
gradfitz=myfit%gradient_z(mid)

allocate(neval(4))
neval(1)=unit(psample(1)-mid)
neval(2)=unit(psample(2)-mid)
neval(3)=unit(neval(2)-(neval(2)*neval(1))*neval(1))
neval(4)=unit(psample(4)-mid)
print*, "Curv1=", vector(gradfit*neval(1),gradfity*neval(1),gradfitz*neval(1))*neval(1)
print*, "Curv2=", vector(gradfit*neval(2),gradfity*neval(2),gradfitz*neval(2))*neval(2)
print*, "Curv3=", vector(gradfit*neval(3),gradfity*neval(3),gradfitz*neval(3))*neval(3)
print*, "Curv4=", vector(gradfit*neval(4),gradfity*neval(4),gradfitz*neval(4))*neval(4)

print*, "H=",(vector(gradfit*neval(1),gradfity*neval(1),gradfitz*neval(1))*neval(1)+vector(gradfit*neval(3),gradfity*neval(3),gradfitz*neval(3))*neval(3))/2d0

psample1=ortho2ortho(psample1,mid,unit_u,unit_v,unit_w)
nsample=ortho2ortho(nsample,unit_u,unit_v,unit_w)

print *, psample1
print *, "----"
print *, nsample

call myfit%set(poly3D)
! remove z-terms
!call myfit%set(linear_xy)
!call myfit%set(quadratic_xy)
call myfit%set(linear_xy)


! get first approximation of coeffs in low order
call myfit%solve(psample1(1:size(psample)),psample1(1:size(psample))%z)

print *,"lin coefs=" ,myfit%coeffs
gradfit = myfit%gradient(O)
Hess = myfit%hessian(O)
!gradfit = myfit%gradient(mid)
!Hess = myfit%hessian(mid)

 area_sumparts = sqrt(gradfit%vx**2+gradfit%vy**2+1d0)

 curvature = (-Hess(1)*(gradfit%vy**2 + 1d0)-Hess(4)*(gradfit%vx**2 + 1d0)+2d0*gradfit%vx*gradfit%vy*Hess(2)) &
                    / (area_sumparts**3d0)

!print *, norm(mid-psample(i)),curvature
print *, "curv=",curvature
print *, "Err Sum", myfit%rsumE2(psample1(1:size(psample)),psample1(1:size(psample))%z)

call myfit%set(cubic_xy)

! iterative improvements
call myfit%zsurf_solve(psample1,nsample,sing_flag=sf1)!,svd_solve=.true.)

print *, sf1

print *, myfit%coeffs

gradfit = myfit%gradient(O)
Hess = myfit%hessian(O)
!gradfit = myfit%gradient(mid)
!Hess = myfit%hessian(mid)

 area_sumparts = sqrt(gradfit%vx**2+gradfit%vy**2+1d0)

 curvature = (-Hess(1)*(gradfit%vy**2 + 1d0)-Hess(4)*(gradfit%vx**2 + 1d0)+2d0*gradfit%vx*gradfit%vy*Hess(2)) &
                    / (area_sumparts**3d0)

!print *, norm(mid-psample(i)),curvature
print *, "curv=",curvature
print *, "Err Sum", myfit%rsumE2(psample1(1:size(psample)),psample1(1:size(psample))%z)

mid=point(minval(psample1%x),minval(psample1%y),0d0)

allocate(gridp,source=make_grid(mid,ii,jj,maxval(abs(mid%x-psample1%x)),maxval(abs(mid%y-psample1%y)),200,200))

open(100,file="fort.m")
write(100,*), 'sps=['
write(100,*), psample1
write(100,*), ']'
gridp%z=myfit%seval(gridp)
write(100,*), 'fps=['
write(100,*), gridp
write(100,*), ']'
close(100) 




end if

end program test_fit4curv
